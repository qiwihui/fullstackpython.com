<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="学习使用 Bokeh，Bottle 和 Python 3 创建响应式条形图。">
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="使用 Bokeh，Bottle 和 Python 3 创建条形图视觉效果" />
<meta name="twitter:image" content="https://www.fullstackpython.com/img/170725-bottle-bokeh-bar-charts/header.jpg" />
<meta name="twitter:site" content="@fullstackpython" />
<meta name="twitter:creator" content="@mattmakai" />
<meta property="og:url" content="https://www.fullstackpython.com/blog/python-bottle-bokeh-bar-charts.html" />
<meta property="og:title" content="使用 Bokeh，Bottle 和 Python 3 创建条形图视觉效果" />
<meta property="og:description" content="学习使用 Bokeh，Bottle 和 Python 3 创建响应式条形图。 Great post on fullstackpython.com!" />
<meta property="og:image" content="https://www.fullstackpython.com/img/170725-bottle-bokeh-bar-charts/header.jpg" />
<link rel="canonical" href="https://www.fullstackpython.com/blog/python-bottle-bokeh-bar-charts.html" />
<title>使用 Bokeh，Bottle 和 Python 3 创建条形图视觉效果 - Full Stack Python</title> <style>hr,img{border:0}*,:after,:before{box-sizing:border-box}html{-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;font-size:18px;background:#fefefe}body{margin:0;font:18px Georgia,serif;line-height:1.4;color:#222;padding:0}img{vertical-align:middle}hr{height:0;box-sizing:content-box;margin:21px 0;border-top:1px solid #eee}h1,h2,h3,h4,h5,h6{font-family:"Helvetica Neue",sans-serif;font-weight:500;line-height:1.1;color:#000}h1,h2,h3{margin:32px 0 6px}h1{font-size:40px}h2{font-size:28px}h3{font-size:22px}h4,h5,h6{margin:11px 0;font-size:18px}p{margin:0 0 12px}ol,ul{margin:0 0 10px}code,pre{font:"Courier New",monospace;border-radius:4px;background-color:#f4f9ff;font-size:12px}code{padding:2px 4px;white-space:nowrap}pre{white-space:pre-wrap;display:block;padding:10px;margin:0 0 11px;line-height:1.4;word-break:break-all;word-wrap:break-word;border:1px solid #ccc}.cn{padding:0 15px 0 15px;margin-right:auto;margin-left:auto}.cn:before,.cn:after{display:table;content:" "}.cn:after{clear:both}.row:before,.row:after{display:table;content:" "}.row:after{clear:both}.c2,.c3,.c4,.c5,.c6,.c7,.c8,.c9,.c10,.c11,.c12{position:relative;min-height:1px;padding:0 15px 0 15px}a{background:transparent;text-decoration:none;border-bottom:1px dotted;color:#444}a:hover{text-decoration:none;color:#000}.ft{padding:0 0 24px;float:right}.sns{font-family:"Helvetica Neue",sans-serif}.sps{font-size:14px}.hd{margin:20px 0 15px 0}.hd>a{border-bottom:none}img.hdr{vertical-align:middle;border:none;height:52px;width:52px;padding:1px}.hdt a,.hdt a:hover{font:72px "Helvetica Neue",sans-serif;font-weight:normal;letter-spacing:.03em;vertical-align:middle;margin-left:5px;color:#000;text-decoration:none;border-bottom:none;line-height:.9em}.bk{margin:0 7px 0 7px}img.nob{border:none}.pn{margin:0 0 21px;background:#fff;border:1px solid transparent;border-radius:4px;border-color:#22b24c}.pnb{padding:15px}.pnb:before,.pnb:after{display:table;content:" "}.pnb:after{clear:both}.pn>.lg{margin-bottom:0}.pn>.lg .lgi{border-width:1px 0;font:14px 'Helvetica Neue',sans-serif;padding:5px 0 5px 10px}.pn>.lg .lgi:first-child{border-top-right-radius:0;border-top-left-radius:0}.pn>.lg .lgi:last-child{border-bottom:0;background-color:#22b24c;color:#fff}.pnh+.lg .lgi:first-child{border-top-width:0}.pnh{padding:10px 15px;border-bottom:1px solid transparent;border-top-right-radius:3px;border-top-left-radius:3px;color:#468847;background-color:#22b24c;border-color:#22b24c}.pn>.pnh>h3{margin:5px 0 0 0;color:#fff}.pn>.pnh>h3>a{color:#fff}.pn>.lg a.lgi.sbc{padding-left:27px}.pn>.lg a.lgi.sbc2{padding-left:35px}#sb{margin-top:40px}.lg{padding-left:0;margin-bottom:20px}.lgi{position:relative;display:block;padding:10px 15px;margin-bottom:-1px;background-color:#fff;border:1px solid #ddd}.lgi:first-child{border-top-right-radius:4px;border-top-left-radius:4px}.lgi:last-child{margin-bottom:0;border-bottom-right-radius:4px;border-bottom-left-radius:4px}a.lgi{color:#333}a.lgi:hover,a.lgi:focus{background:#ddd}a.lgi.active{z-index:2;background:#444;color:#fff;border:1px solid #222}.btn-full{width:100%;box-shadow:1px 2px 1px #222;padding-bottom:4px}p.under-btn{text-align:left;margin-top:20px}p.banner{font-weight:500;line-height:1.1;color:#fff;font-size:22px;margin:14px 0 18px 0}th{text-align:left;font-family:"Helvetica Neue",sans-serif}td{padding-right:20px}blockquote{border-left:4px solid #aaa;padding-left:10px;font-family:"Helvetica Neue"}.well{min-height:20px;padding:19px;margin:0 0 20px;background-color:#f5f5f5;border:1px solid #e3e3e3;border-radius:4px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.05)}.see-also{margin-top:20px;background:#22B24C;color:#eee;font-family:"Helvetica Neue",sans-serif}.see-also a{color: #fff}.highlight{background:#ffff00}.form-control{display:block;width:100%;height:39px;padding:8px 12px;font-size:14px;color:#777;vertical-align:middle;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:4px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.075);transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}.form-control:focus{border-color:#66afe9;outline:0;box-shadow:inset 0 1px 1px rgba(0,0,0,0.075),0 0 8px rgba(102,175,233,0.6)}.btn{display:inline-block;padding:8px 12px;margin-bottom:0;font-size:15px;line-height:1.4;text-align:center;white-space:nowrap;vertical-align:middle;cursor:pointer;border:1px solid transparent;border-radius:4px;color:#fff;background-color:#22b24c;border-color:#22b24c}.btn:active,.btn.active{background-image:none;outline:0;box-shadow:inset 0 3px 5px rgba(0,0,0,0.125)}img.rnd{border:1px solid #ccc;border-radius:5px}.shot{border-radius:5px}.outl{border: 1px solid #ccc}.talk{margin-bottom:22px}@media (min-width:750px){.cn{width:730px}}@media (min-width:768px){.cn{width:750px}#full-toc{display:block}#mobile-toc{display:none}.c3,.c4,.c6,.c8,.c9,.c12{float:left}.c12{width:100%} .c9{width:75%} .c6{width:50%} .c8{width:66.66666666666666%} .c4{width:33.33333333333333%} .c3{width:25%} .co1{margin-left:8.333333333333332%} .select-next{min-height:300px}}@media (min-width:940px){.cn{width:920px}}@media (min-width:1140px){.cn{width:1120px}}.row{margin-right:-15px;margin-left:-15px} @media (max-width:767px){#full-toc{display:none} .hd{padding:8px 0 10px; margin:0} .hdt a,.hdt a:hover{font-size:34px} h1{font-size:28px} h2{font-size:24px} img.hdr{height:26px;width:26px} pre{font-size:60%}} @media (min-width:1140px){.select-next{min-height:220px}}</style><link rel="shortcut icon" href="/img/fsp-fav.png">
</head>
<body>
<div class="cn">
<div class="row"><div class="c12"><div class="hd"><a href="https://fullstackpython.qiwihui.com/"><img src="/img/logos/f.png" class="hdr" alt="Full Stack Python logo"></a><span class="hdt"> <a href="https://fullstackpython.qiwihui.com/">全栈 Python</a></span></div><div class="sns">
<a href="/table-of-contents.html">全部主题</a> <span class="bk">|</span>
<a href="/blog.html">博客</a> <span class="bk">|</span>
<a href="/email.html">邮件订阅</a> <span class="bk">|</span>
<a href="https://twitter.com/fullstackpython">@fullstackpython</a> <span class="bk">|</span>
<a href="https://www.facebook.com/fullstackpython">Facebook</a> <span class="bk">|</span>
<a href="/change-log.html">更新日志</a> <span class="bk">|</span>
<a href="https://github.com/qiwihui/fullstackpython.com">源码</a> 
</div></div></div><div class="row">
 <div class="c12">
  <h1 style="font-size: 36px;">使用 Bokeh，Bottle 和 Python 3 创建条形图视觉效果</h1>
  <div style="font-size:12px;color:#666;margin:0 0 10px">
     Post updated by <a href="/about-author.html">Matt Makai</a> on 
     July 30, 2017. Originally posted
     on July 25, 2017.
  </div>
 </div>
</div>
<div class="row">
  <div class="c9">
   <p>The <a href="/bokeh.html">Bokeh</a> open source Python visualization library assists 
developers with creating web browser visuals. You can build charts for 
web applications <em>without coding any JavaScript</em>, like you'd need to do
to use libraries such as <a href="https://d3js.org/">d3.js</a> and plotly.</p>
<p>Bokeh can create many common and custom visualizations using only
Python, such as this bar chart we will create in this tutorial:</p>
<p><img src="/img/170725-bottle-bokeh-bar-charts/chart-example-48.png" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="Responsive Bokeh bar chart with 48 bars."></p>
<p>Let's use the 
<a href="/bottle.html">Bottle</a> <a href="/web-frameworks.html">web framework</a> with Bokeh to 
build custom Python web app bar charts.</p>
<h2>Our Tools</h2>
<p>This tutorial works with either <a href="/python-2-or-3.html">Python 2 or 3</a>, 
but Python 3 is strongly recommended for new applications. I used
<a href="https://www.python.org/downloads/release/python-362/">Python 3.6.2</a> while 
writing this post. In addition to Python throughout this tutorial we 
will also use the following 
<a href="/application-dependencies.html">application dependencies</a>: </p>
<ul>
<li><a href="/bottle.html">Bottle</a> web framework, 
  <a href="https://github.com/bottlepy/bottle/tree/0.12.13">version 0.12.13</a></li>
<li><a href="/bokeh.html">Bokeh</a> data visualization library, 
  <a href="https://github.com/bokeh/bokeh/releases/tag/0.12.6">version 0.12.6</a></li>
<li><a href="/pandas.html">pandas</a> data structures and analysis library, 
  <a href="https://github.com/pandas-dev/pandas/releases/tag/v0.20.3">version 0.20.3</a></li>
<li><a href="https://pip.pypa.io/en/stable/">pip</a> and 
  <a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a>, which come
  packaged with Python 3, to install and isolate the Bottle, Bokeh,
  and pandas libraries from other Python projects you are working on</li>
</ul>
<p>If you need help getting your 
<a href="/development-environments.html">development environment</a> configured
before running this code, take a look at
<a href="/blog/python-3-bottle-gunicorn-ubuntu-1604-xenial-xerus.html">this guide for setting up Python 3 and Bottle on Ubuntu 16.04 LTS</a>.</p>
<p>All code in this blog post is available open source under the MIT license 
on GitHub under the 
<a href="https://github.com/fullstackpython/blog-code-examples">bar-charts-bokeh-bottle-python-3 directory of the blog-code-examples repository</a>. 
Use the source code as you want to for your own projects.</p>
<h2>Installing Bottle and Bokeh</h2>
<p>Create a new virtual environment for this project to isolate our 
dependencies using the following command in the terminal. I usually run the 
venv command within a separate <code>venvs</code> directory where all my virtualenvs
are store.</p>
<div class="highlight"><pre><span></span>python3 -m venv bottlechart
</pre></div>


<p>Activate the virtualenv.</p>
<div class="highlight"><pre><span></span><span class="nb">source</span> bottlechart/bin/activate
</pre></div>


<p>The command prompt will change after activating the virtualenv:</p>
<p><img src="/img/170725-bottle-bokeh-bar-charts/activate-virtualenv.png" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="Activating our Python virtualenv for this project on the command line."></p>
<p>Keep in mind that you need to activate the virtualenv in every new terminal 
window where you want to use the virtualenv to run the project.</p>
<p>Bokeh and Bottle are installable into the now-activated virtualenv
using pip. Run this command to get the appropriate Bokeh and Bottle
versions.</p>
<div class="highlight"><pre><span></span>pip install bokeh==0.12.6 bottle==0.12.13 pandas==0.20.3
</pre></div>


<p>Our required dependencies will be installed within our virtualenv after
a brief download and installation period.</p>
<div class="highlight"><pre><span></span>Installing collected packages: bottle, six, chardet, certifi, idna, urllib3, requests, PyYAML, python-dateutil, MarkupSafe, Jinja2, numpy, tornado, bkcharts, bokeh, pytz, pandas
  Running setup.py install for bottle ... done
  Running setup.py install for PyYAML ... done
  Running setup.py install for MarkupSafe ... done
  Running setup.py install for tornado ... done
  Running setup.py install for bkcharts ... done
  Running setup.py install for bokeh ... done
Successfully installed Jinja2-2.9.6 MarkupSafe-1.0 PyYAML-3.12 bkcharts-0.2 bokeh-0.12.6 bottle-0.12.13 certifi-2017.7.27.1 chardet-3.0.4 idna-2.5 numpy-1.13.1 pandas-0.20.3 python-dateutil-2.6.1 pytz-2017.2 requests-2.18.2 six-1.10.0 tornado-4.5.1 urllib3-1.22
</pre></div>


<p>We can now begin coding our web app.</p>
<h2>Building the Bottle App</h2>
<p>First we'll code a basic Bottle application and then we will add the
bar charts to the rendered page.</p>
<p>Create a folder for your project named <code>bottle-bokeh-charts</code>. Within
<code>bottle-bokeh-charts</code> create a new file named <code>app.py</code> with the following
code: </p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">bottle</span>
<span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">template</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">bottle</span><span class="o">.</span><span class="n">default_app</span><span class="p">()</span>

<span class="n">TEMPLATE_STRING</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;html&gt;</span>
<span class="s2"> &lt;head&gt;</span>
<span class="s2">  &lt;title&gt;Bar charts with Bottle and Bokeh&lt;/title&gt;</span>
<span class="s2"> &lt;/head&gt;</span>
<span class="s2"> &lt;body&gt;</span>
<span class="s2">  &lt;h1&gt;Bugs found over the past {{ bars_count }} days&lt;/h1&gt;</span>
<span class="s2"> &lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/&lt;num_bars:int&gt;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">chart</span><span class="p">(</span><span class="n">num_bars</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a simple template stating the number of bars that should</span>
<span class="sd">    be generated when the rest of the function is complete.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">num_bars</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">num_bars</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="n">TEMPLATE_STRING</span><span class="p">,</span> <span class="n">bars_count</span><span class="o">=</span><span class="n">num_bars</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">reloader</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>The code shown above provides a short <a href="/bottle.html">Bottle</a> application
with a single route, defined with the <code>chart</code> function. <code>chart</code> receives
an arbitrary integer value as input. The <code>template</code> function within 
<code>chart</code> uses the HTML template defined in <code>TEMPLATE_STRING</code> to render
an HTML page as a response to incoming requests.</p>
<p>The last two lines in the allow us to run the Bottle application 
in debug mode on port 8000. 
<strong>Never use debug mode for production deployments!</strong>
<a href="/wsgi-servers.html">WSGI servers</a> like 
<a href="/green-unicorn-gunicorn.html">Gunicorn</a> are built for handling real
traffic and will be easier to configure without major security
holes.</p>
<p>We can now test out our application.</p>
<p>Make sure your virtualenv is still activated and that you are in the 
base directory of your project where <code>app.py</code> is located. Run <code>app.py</code>
using the <code>python</code> command.</p>
<div class="highlight"><pre><span></span>(bottlechart)$ python app.py
</pre></div>


<p>Go to <a href="http://localhost:8000/16/">localhost:8000/16/</a> in your web browser.
You should see a header message about the number of bugs found over the
past 16 days. However, there's no bar chart to accompany that message
just yet.</p>
<p><img src="/img/170725-bottle-bokeh-bar-charts/basic-app-no-chart.png" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="A simple Bottle app without the bar chart."></p>
<p>Our single Bottle route is in place but it is not very exciting. Time
to create a nice-looking bar chart.</p>
<h2>Creating A Bar Chart with Bokeh</h2>
<p>We'll build on our basic Bottle app foundation using some new Python code 
to engage the <a href="/bokeh.html">Bokeh</a> library. </p>
<p>Open <code>app.py</code> back up and add the following highlighted import lines.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">bottle</span>
<span class="highlight"><span class="o"></span><span class="kn">import</span> <span class="nn">random</span></span>
<span class="highlight"><span class="o"></span><span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="p">(</span><span class="n">HoverTool</span><span class="p">,</span> <span class="n">FactorRange</span><span class="p">,</span> <span class="n">Plot</span><span class="p">,</span> <span class="n">LinearAxis</span><span class="p">,</span> <span class="n">Grid</span><span class="p">,</span></span>
<span class="highlight"><span class="o"></span>                          <span class="n">Range1d</span><span class="p">)</span></span>
<span class="highlight"><span class="o"></span><span class="kn">from</span> <span class="nn">bokeh.models.glyphs</span> <span class="kn">import</span> <span class="n">VBar</span></span>
<span class="highlight"><span class="o"></span><span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span></span>
<span class="highlight"><span class="o"></span><span class="kn">from</span> <span class="nn">bokeh.charts</span> <span class="kn">import</span> <span class="n">Bar</span></span>
<span class="highlight"><span class="o"></span><span class="kn">from</span> <span class="nn">bokeh.embed</span> <span class="kn">import</span> <span class="n">components</span></span>
<span class="highlight"><span class="o"></span><span class="kn">from</span> <span class="nn">bokeh.models.sources</span> <span class="kn">import</span> <span class="n">ColumnDataSource</span></span>
<span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">template</span>
</pre></div>


<p>The rest of our application will use these imports to generate random
data and the bar chart.</p>
<p>Our bar chart will have "software bugs found" for its theme. The data will
randomly generate each time the page is generated. In a real application
you would of course likely have a more stable and useful data source.</p>
<p>Continue modifying <code>app.py</code> so the section after the imports looks like
the following code. </p>
<div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">bottle</span><span class="o">.</span><span class="n">default_app</span><span class="p">()</span>

<span class="n">TEMPLATE_STRING</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;html&gt;</span>
<span class="s2"> &lt;head&gt;</span>
<span class="s2">  &lt;title&gt;Bar charts with Bottle and Bokeh&lt;/title&gt;</span>
<span class="highlight"><span class="s2">  &lt;link href=&quot;http://cdn.pydata.org/bokeh/release/bokeh-0.12.6.min.css&quot; </span></span>
<span class="highlight"><span class="s2">        rel=&quot;stylesheet&quot;&gt;</span></span>
<span class="highlight"><span class="s2">  &lt;link href=&quot;http://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.6.min.css&quot; </span></span>
<span class="highlight"><span class="s2">        rel=&quot;stylesheet&quot;&gt;</span></span>
<span class="s2"> &lt;/head&gt;</span>
<span class="s2"> &lt;body&gt;</span>
<span class="s2">  &lt;h1&gt;Bugs found over the past {{ bars_count }} days&lt;/h1&gt;</span>
<span class="highlight"><span class="s2">  {{ !the_div }}</span></span>
<span class="highlight"><span class="s2">  &lt;script src=&quot;http://cdn.pydata.org/bokeh/release/bokeh-0.12.6.min.js&quot;&gt;&lt;/script&gt;</span></span>
<span class="highlight"><span class="s2">  &lt;script src=&quot;http://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.6.min.js&quot;&gt;&lt;/script&gt;</span></span>
<span class="highlight"><span class="s2">  {{ !the_script }}</span></span>
<span class="s2"> &lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/&lt;num_bars:int&gt;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">chart</span><span class="p">(</span><span class="n">num_bars</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a simple template stating the number of bars that should</span>
<span class="sd">    be generated when the rest of the function is complete.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">num_bars</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">num_bars</span> <span class="o">=</span> <span class="mi">1</span>
<span class="highlight"><span class="o"></span>    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;days&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;bugs&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;costs&quot;</span><span class="p">:</span> <span class="p">[]}</span></span>
<span class="highlight"><span class="o"></span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_bars</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span></span>
<span class="highlight"><span class="o"></span>        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></span>
<span class="highlight"><span class="o"></span>        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;bugs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span></span>
<span class="highlight"><span class="o"></span>        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;costs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">1.00</span><span class="p">,</span> <span class="mf">1000.00</span><span class="p">))</span></span>

<span class="highlight"><span class="o"></span>    <span class="n">hover</span> <span class="o">=</span> <span class="n">create_hover_tool</span><span class="p">()</span></span>
<span class="highlight"><span class="o"></span>    <span class="n">plot</span> <span class="o">=</span> <span class="n">create_bar_chart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Bugs found per day&quot;</span><span class="p">,</span> <span class="s2">&quot;days&quot;</span><span class="p">,</span></span>
<span class="highlight"><span class="o"></span>                            <span class="s2">&quot;bugs&quot;</span><span class="p">,</span> <span class="n">hover</span><span class="p">)</span></span>
<span class="highlight"><span class="o"></span>    <span class="n">script</span><span class="p">,</span> <span class="n">div</span> <span class="o">=</span> <span class="n">components</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span></span>
<span class="highlight"><span class="o"></span>    <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="n">TEMPLATE_STRING</span><span class="p">,</span> <span class="n">bars_count</span><span class="o">=</span><span class="n">num_bars</span><span class="p">,</span></span>
<span class="highlight"><span class="o"></span>                    <span class="n">the_div</span><span class="o">=</span><span class="n">div</span><span class="p">,</span> <span class="n">the_script</span><span class="o">=</span><span class="n">script</span><span class="p">)</span></span>
</pre></div>


<p>The <code>chart</code> function gains three new lists that are randomly generated by 
<a href="https://docs.python.org/3/library/random.html">Python 3's super-handy random module</a>.</p>
<p><code>chart</code> calls two functions, <code>create_hover_tool</code> and <code>create_bar_chart</code>.
We haven't written those functions yet, so let's do that now. Add these
two new functions below the <code>chart</code> function, but before the 
<code>if __name__ == '__main__':</code> line.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_hover_tool</span><span class="p">():</span>
    <span class="c1"># we&#39;ll code this function in a moment</span>
    <span class="k">return</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">create_bar_chart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">x_name</span><span class="p">,</span> <span class="n">y_name</span><span class="p">,</span> <span class="n">hover_tool</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a bar chart plot with the exact styling for the centcom</span>
<span class="sd">       dashboard. Pass in data as a dictionary, desired plot title,</span>
<span class="sd">       name of x axis, y axis and the hover tool HTML.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">xdr</span> <span class="o">=</span> <span class="n">FactorRange</span><span class="p">(</span><span class="n">factors</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">x_name</span><span class="p">])</span>
    <span class="n">ydr</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">y_name</span><span class="p">])</span><span class="o">*</span><span class="mf">1.5</span><span class="p">)</span>

    <span class="n">tools</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">hover_tool</span><span class="p">:</span>
        <span class="n">tools</span> <span class="o">=</span> <span class="p">[</span><span class="n">hover_tool</span><span class="p">,]</span>

    <span class="n">plot</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_range</span><span class="o">=</span><span class="n">xdr</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="n">ydr</span><span class="p">,</span> <span class="n">plot_width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                  <span class="n">plot_height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">h_symmetry</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">v_symmetry</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                  <span class="n">min_border</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">toolbar_location</span><span class="o">=</span><span class="s2">&quot;above&quot;</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
                  <span class="n">responsive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">outline_line_color</span><span class="o">=</span><span class="s2">&quot;#666666&quot;</span><span class="p">)</span>

    <span class="n">glyph</span> <span class="o">=</span> <span class="n">VBar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_name</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">y_name</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">=.</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;#6599ed&quot;</span><span class="p">)</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">add_glyph</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">glyph</span><span class="p">)</span>

    <span class="n">xaxis</span> <span class="o">=</span> <span class="n">LinearAxis</span><span class="p">()</span>
    <span class="n">yaxis</span> <span class="o">=</span> <span class="n">LinearAxis</span><span class="p">()</span>

    <span class="n">plot</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">Grid</span><span class="p">(</span><span class="n">dimension</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ticker</span><span class="o">=</span><span class="n">xaxis</span><span class="o">.</span><span class="n">ticker</span><span class="p">))</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">Grid</span><span class="p">(</span><span class="n">dimension</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ticker</span><span class="o">=</span><span class="n">yaxis</span><span class="o">.</span><span class="n">ticker</span><span class="p">))</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">logo</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">min_border_top</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="s2">&quot;#999999&quot;</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;Bugs found&quot;</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;Days after app deployment&quot;</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">plot</span>
</pre></div>


<p>That's a lot of new code. The <code>create_hover_tool</code> function does not do 
anything just yet other than returning.  <code>None</code>, which is used when no
hover tool is desired for the graph.</p>
<p>Within the <code>create_bar_chart</code> function we take in our randomly-generated 
data source and convert it into a <code>ColumnDataSource</code> object that is one 
type of input object we can pass to Bokeh functions. We specify two ranges 
for the chart's x and y axes.</p>
<p>The <code>tools</code> list will remain empty because we do not yet have a hover tool.
A lot of the magic happens in the lines where we create <code>plot</code> using the 
<code>figure</code> function. We specify all the parameters we want our graph to have
such as the size, toolbar, borders and whether or not the graph should be
responsive upon changing the web browser size.</p>
<p>The <code>VBar</code> object creates vertical bars to add them to the plot with
the <code>add_glyph</code> function.</p>
<p>The last lines of the function change the graph's appearance. For
example, we took away the <code>Bokeh</code> logo by specifying 
<code>plot.toolbar.logo = None</code> and added labels to both axes. I recommend 
keeping the 
<a href="http://bokeh.pydata.org/en/latest/docs/reference/plotting.html#bokeh-plotting">bokeh.plotting</a>
documentation open so you know what your options are for customizing the
charts and visualizations.</p>
<p>Let's test our app by trying a 6-bar chart. The Bottle app should 
automatically reload when you save <code>app.py</code> with the new code. If you shut 
down the development server, start it back up using <code>python app.py</code>.</p>
<p>When you start up the development server you will receive the following 
warning because we are using the latest (at the time of this writing) 0.12.6 
Bokeh release. </p>
<div class="highlight"><pre><span></span>/Users/matt/Envs/bottlechart/lib/python3.6/site-packages/bokeh/util/deprecation.py:34: BokehDeprecationWarning: 
The bokeh.charts API has moved to a separate &#39;bkcharts&#39; package.

This compatibility shim will remain until Bokeh 1.0 is released.
After that, if you want to use this API you will have to install
the bkcharts package explicitly.
</pre></div>


<p>Eventually a separate <code>bkcharts</code> project will be required but for now 
we can keep our code as is.</p>
<p>Open your browser to <a href="http://localhost:8000/6/">localhost:8000/6/</a>.</p>
<p><img src="/img/170725-bottle-bokeh-bar-charts/chart-example-6.png" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="Responsive Bokeh bar chart with 6 bars."></p>
<p>That one looks a bit sparse, so we can crank it up by 3x to 18 bars
by going to <a href="http://localhost:5000/18/">localhost:5000/18/</a>.</p>
<p><img src="/img/170725-bottle-bokeh-bar-charts/chart-example-18.png" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="Responsive Bokeh bar chart with 18 bars."></p>
<p>Now another 5x to 90 bars with 
<a href="http://localhost:8000/90/">localhost:5000/90/</a>.</p>
<p><img src="/img/170725-bottle-bokeh-bar-charts/chart-example-90.png" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="Responsive Bokeh bar chart with 90 bars."></p>
<p>Looking good so far! What about that hover tool we skipped over though?
We can add the hover tool with just a few more lines of code in the 
<code>create_hover_tool</code> function.</p>
<h2>Creating a Hover Tool</h2>
<p>Add these highlighted lines to <code>app.py</code> within the <code>create_hover_tool</code>
function.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_hover_tool</span><span class="p">():</span>
<span class="highlight"><span class="o"></span>    <span class="s2">&quot;&quot;&quot;Generates the HTML for the Bokeh&#39;s hover data tool on our graph.&quot;&quot;&quot;</span></span>
<span class="highlight"><span class="o"></span>    <span class="n">hover_html</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span></span>
<span class="highlight"><span class="s2">      &lt;div&gt;</span></span>
<span class="highlight"><span class="s2">        &lt;span class=&quot;hover-tooltip&quot;&gt;$x&lt;/span&gt;</span></span>
<span class="highlight"><span class="s2">      &lt;/div&gt;</span></span>
<span class="highlight"><span class="s2">      &lt;div&gt;</span></span>
<span class="highlight"><span class="s2">        &lt;span class=&quot;hover-tooltip&quot;&gt;@bugs bugs&lt;/span&gt;</span></span>
<span class="highlight"><span class="s2">      &lt;/div&gt;</span></span>
<span class="highlight"><span class="s2">      &lt;div&gt;</span></span>
<span class="highlight"><span class="s2">        &lt;span class=&quot;hover-tooltip&quot;&gt;$@costs{0.00}&lt;/span&gt;</span></span>
<span class="highlight"><span class="s2">      &lt;/div&gt;</span></span>
<span class="highlight"><span class="s2">    &quot;&quot;&quot;</span></span>
<span class="highlight"><span class="o"></span>    <span class="k">return</span> <span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="n">hover_html</span><span class="p">)</span></span>
</pre></div>


<p>Embedding HTML within your Python application isn't usually a great
idea but it works for small snippets like this hover tool.
The hover tool uses <code>$x</code> to show the bar's x axis, <code>@bugs</code> to show the 
"bugs" field from our data source, and <code>$@costs{0.00}</code> to show the "costs" 
field formatted as a dollar amount with exactly 2 decimal places.</p>
<p>Ensure that you changed <code>return None</code> to 
<code>return HoverTool(tooltips=hover_html)</code> in your function so the results of 
the new code are reflected in the refreshed graph.</p>
<p>Go back to the browser and reload the 
<a href="http://localhost:8000/122">localhost:8000/122/</a> page.</p>
<p><img src="/img/170725-bottle-bokeh-bar-charts/chart-example-122.png" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="Responsive Bokeh bar chart with 122 bars."></p>
<p>Well done! Try playing around with the number of bars in the URL and the
window size to see what the graph looks like under different conditions.</p>
<p>The chart gets crowded with more than 100. However, you can try to create
as many bars as you want if your computer can handle the rendering.
This screenshot shows what the completely impractical amount of 40,000
bars looks like:</p>
<p><img src="/img/170725-bottle-bokeh-bar-charts/chart-example-40000.png" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="Responsive Bokeh bar chart with 40000 bars."></p>
<p>You may need to do some more work to get the chart to be useful for displaying
more than a couple hundred bars at a time.</p>
<h2>What now?</h2>
<p>We created a nice little configurable bar chart using the Bokeh code library. </p>
<p>Next you can change the input data source, work with other types of charts
or modify the chart color scheme.</p>
<p>There is a lot more than Bokeh can do. Take a look at the 
<a href="http://bokeh.pydata.org/en/latest/">official project documentation</a> , 
<a href="https://github.com/bokeh/bokeh">GitHub repository</a>, 
the <a href="/bokeh.html">Full Stack Python Bokeh page</a> or take a look at 
<a href="/table-of-contents.html">other topics on Full Stack Python</a>.</p>
<p>Questions? Let me know via 
<a href="https://github.com/mattmakai/fullstackpython.com/issues">a GitHub issue ticket on the Full Stack Python repository</a>, 
on Twitter 
<a href="https://twitter.com/fullstackpython">@fullstackpython</a>
or <a href="https://twitter.com/mattmakai">@mattmakai</a>.</p>
<p>Do you see something wrong in this blog post? Fork
<a href="https://github.com/mattmakai/fullstackpython.com/blob/master/content/posts/170725-bar-charts-bottle-bokeh.markdown">this page's source on GitHub</a>
and submit a pull request with a fix.</p>
   <hr>
<div id="mc_embed_signup">
<form action="//mattmakai.us2.list-manage.com/subscribe/post?u=b7e774f0c4f05dcebbfee183d&amp;id=b22335388d" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
 <div id="mc_embed_signup_scroll">
  <h4>Sign up for a monthly email with Full Stack Python tutorials. No spam ever.</h4>
  <div class="row">
   <div class="c9">
    <input type="email" value="" name="EMAIL" class="email form-control" id="mce-EMAIL" placeholder="email address" required>
    <div style="position: absolute; left: -5000px;"><input type="text" name="b_b7e774f0c4f05dcebbfee183d_b22335388d" tabindex="-1" value=""></div>
   </div>
   <div class="c3">
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="btn btn-success" style="font-family: 'Helvetica Neue'; margin-bottom:6px"></div>
   </div>
  </div>
 </div>
</form>
</div>  </div>
  <div class="c3">
<div class="pn">
 <div class="pnh">
  <h3>Learn more</h3>
 </div>
 <img src="/img/170725-bottle-bokeh-bar-charts/header.jpg" alt="Python, Bottle 和 Bokeh logos。" width="100%"> 
 <div class="lg">
<a href="/bokeh.html" class="lgi">Bokeh</a>
<a href="/web-frameworks.html" class="lgi">Web Frameworks</a>
<a href="/bottle.html" class="lgi">Bottle</a>
<a href="/deployment.html" class="lgi">Deployment</a>
<a href="/ubuntu.html" class="lgi">Ubuntu</a>
<a href="/wsgi-servers.html" class="lgi">WSGI Servers</a>
<a href="/green-unicorn-gunicorn.html" class="lgi">Green Unicorn (Gunicorn)</a>
<a href="http://bokeh.pydata.org/en/latest/" class="lgi">Official Bokeh Docs <svg width="20" height="12" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1408 928v320q0 119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119 84.5-203.5t203.5-84.5h704q14 0 23 9t9 23v64q0 14-9 23t-23 9h-704q-66 0-113 47t-47 113v832q0 66 47 113t113 47h832q66 0 113-47t47-113v-320q0-14 9-23t23-9h64q14 0 23 9t9 23zm384-864v512q0 26-19 45t-45 19-45-19l-176-176-652 652q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l652-652-176-176q-19-19-19-45t19-45 45-19h512q26 0 45 19t19 45z"/></svg></a>
<a href="https://github.com/fullstackpython/blog-code-examples/tree/master/bar-charts-bokeh-bottle-python-3" class="lgi">Code for this post <svg width="20" height="12" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1408 928v320q0 119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119 84.5-203.5t203.5-84.5h704q14 0 23 9t9 23v64q0 14-9 23t-23 9h-704q-66 0-113 47t-47 113v832q0 66 47 113t113 47h832q66 0 113-47t47-113v-320q0-14 9-23t23-9h64q14 0 23 9t9 23zm384-864v512q0 26-19 45t-45 19-45-19l-176-176-652 652q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l652-652-176-176q-19-19-19-45t19-45 45-19h512q26 0 45 19t19 45z"/></svg></a>  <a href="/table-of-contents.html" class="lgi">...or view all topics.</a>
 </div>
</div><div class="pn">
 <div class="pnh"><h3>Sponsored By</h3></div>
 <div class="pnb">
<a href="https://rollbar.com/"><img src="/img/logos/rbw.jpg" alt="Rollbar logo" width="100%" style="padding:12px 0 18px"></a>
<p class="sps">Fix errors in your Python code before your users see them by <a href="https://rollbar.com/">monitoring with Rollbar</a>.</p> </div>
</div>  </div>
</div>
<hr></div> 
<div style="margin: 0 0 12px;background-color: #22B24C;">
 <div class="cn">
  <p class="banner sns">
   <a href="https://training.talkpython.fm/courses/explore_ansible/introduction-to-ansible-with-python" style="color: #fff">Learn to deploy and configure servers with Ansible in my latest video course</a>!
  </p>
 </div>
</div>
<div class="container">
    <div class="footer pull-right" style="text-align:right; font-size:85%;">
        This site is based on <a href="https://github.com/mattmakai">Matt Makai</a>'s project <a href="https://github.com/mattmakai/fullstackpython.com">Full Stack Python</a>, thanks for his excellent work!
    </div>
</div>
<div class="container">
    <div class="footer pull-right" style="text-align:right; font-size:85%;">
        <p>此网站由 <a href="https://github.com/qiwihui">@qiwihui</a> 维护。
          若发现错误或想贡献，请访问： <a href="https://github.com/qiwihui/fullstackpython.com">Github qiwihui/fullstackpython.com 项目</a>
        </p>
    </div>
</div><script async src="https://www.googletagmanager.com/gtag/js?id=UA-46660488-4"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-46660488-4');</script>
</body>
</html>