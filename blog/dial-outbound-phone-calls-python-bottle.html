<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="一个教程，演示如何使用 Python 3 构建的 Bottle Web 应用程序拨打出站电话。">
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="使用 Bottle Web 应用程序拨打出站电话" />
<meta name="twitter:image" content="https://www.fullstackpython.com/img/160830-phone-calls-bottle/header.jpg" />
<meta name="twitter:site" content="@fullstackpython" />
<meta name="twitter:creator" content="@mattmakai" />
<meta property="og:url" content="https://www.fullstackpython.com/blog/dial-outbound-phone-calls-python-bottle.html" />
<meta property="og:title" content="使用 Bottle Web 应用程序拨打出站电话" />
<meta property="og:description" content="一个教程，演示如何使用 Python 3 构建的 Bottle Web 应用程序拨打出站电话。 Great post on fullstackpython.com!" />
<meta property="og:image" content="https://www.fullstackpython.com/img/160830-phone-calls-bottle/header.jpg" />
<link rel="canonical" href="https://www.fullstackpython.com/blog/dial-outbound-phone-calls-python-bottle.html" />
<title>使用 Bottle Web 应用程序拨打出站电话 - Full Stack Python</title> <style>hr,img{border:0}*,:after,:before{box-sizing:border-box}html{-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;font-size:18px;background:#fefefe}body{margin:0;font:18px Georgia,serif;line-height:1.4;color:#222;padding:0}img{vertical-align:middle}hr{height:0;box-sizing:content-box;margin:21px 0;border-top:1px solid #eee}h1,h2,h3,h4,h5,h6{font-family:"Helvetica Neue",sans-serif;font-weight:500;line-height:1.1;color:#000}h1,h2,h3{margin:32px 0 6px}h1{font-size:40px}h2{font-size:28px}h3{font-size:22px}h4,h5,h6{margin:11px 0;font-size:18px}p{margin:0 0 12px}ol,ul{margin:0 0 10px}code,pre{font:"Courier New",monospace;border-radius:4px;background-color:#f4f9ff;font-size:12px}code{padding:2px 4px;white-space:nowrap}pre{white-space:pre-wrap;display:block;padding:10px;margin:0 0 11px;line-height:1.4;word-break:break-all;word-wrap:break-word;border:1px solid #ccc}.cn{padding:0 15px 0 15px;margin-right:auto;margin-left:auto}.cn:before,.cn:after{display:table;content:" "}.cn:after{clear:both}.row:before,.row:after{display:table;content:" "}.row:after{clear:both}.c2,.c3,.c4,.c5,.c6,.c7,.c8,.c9,.c10,.c11,.c12{position:relative;min-height:1px;padding:0 15px 0 15px}a{background:transparent;text-decoration:none;border-bottom:1px dotted;color:#444}a:hover{text-decoration:none;color:#000}.ft{padding:0 0 24px;float:right}.sns{font-family:"Helvetica Neue",sans-serif}.sps{font-size:14px}.hd{margin:20px 0 15px 0}.hd>a{border-bottom:none}img.hdr{vertical-align:middle;border:none;height:52px;width:52px;padding:1px}.hdt a,.hdt a:hover{font:72px "Helvetica Neue",sans-serif;font-weight:normal;letter-spacing:.03em;vertical-align:middle;margin-left:5px;color:#000;text-decoration:none;border-bottom:none;line-height:.9em}.bk{margin:0 7px 0 7px}img.nob{border:none}.pn{margin:0 0 21px;background:#fff;border:1px solid transparent;border-radius:4px;border-color:#22b24c}.pnb{padding:15px}.pnb:before,.pnb:after{display:table;content:" "}.pnb:after{clear:both}.pn>.lg{margin-bottom:0}.pn>.lg .lgi{border-width:1px 0;font:14px 'Helvetica Neue',sans-serif;padding:5px 0 5px 10px}.pn>.lg .lgi:first-child{border-top-right-radius:0;border-top-left-radius:0}.pn>.lg .lgi:last-child{border-bottom:0;background-color:#22b24c;color:#fff}.pnh+.lg .lgi:first-child{border-top-width:0}.pnh{padding:10px 15px;border-bottom:1px solid transparent;border-top-right-radius:3px;border-top-left-radius:3px;color:#468847;background-color:#22b24c;border-color:#22b24c}.pn>.pnh>h3{margin:5px 0 0 0;color:#fff}.pn>.pnh>h3>a{color:#fff}.pn>.lg a.lgi.sbc{padding-left:27px}.pn>.lg a.lgi.sbc2{padding-left:35px}#sb{margin-top:40px}.lg{padding-left:0;margin-bottom:20px}.lgi{position:relative;display:block;padding:10px 15px;margin-bottom:-1px;background-color:#fff;border:1px solid #ddd}.lgi:first-child{border-top-right-radius:4px;border-top-left-radius:4px}.lgi:last-child{margin-bottom:0;border-bottom-right-radius:4px;border-bottom-left-radius:4px}a.lgi{color:#333}a.lgi:hover,a.lgi:focus{background:#ddd}a.lgi.active{z-index:2;background:#444;color:#fff;border:1px solid #222}.btn-full{width:100%;box-shadow:1px 2px 1px #222;padding-bottom:4px}p.under-btn{text-align:left;margin-top:20px}p.banner{font-weight:500;line-height:1.1;color:#fff;font-size:22px;margin:14px 0 18px 0}th{text-align:left;font-family:"Helvetica Neue",sans-serif}td{padding-right:20px}blockquote{border-left:4px solid #aaa;padding-left:10px;font-family:"Helvetica Neue"}.well{min-height:20px;padding:19px;margin:0 0 20px;background-color:#f5f5f5;border:1px solid #e3e3e3;border-radius:4px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.05)}.see-also{margin-top:20px;background:#22B24C;color:#eee;font-family:"Helvetica Neue",sans-serif}.see-also a{color: #fff}.highlight{background:#ffff00}.form-control{display:block;width:100%;height:39px;padding:8px 12px;font-size:14px;color:#777;vertical-align:middle;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:4px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.075);transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}.form-control:focus{border-color:#66afe9;outline:0;box-shadow:inset 0 1px 1px rgba(0,0,0,0.075),0 0 8px rgba(102,175,233,0.6)}.btn{display:inline-block;padding:8px 12px;margin-bottom:0;font-size:15px;line-height:1.4;text-align:center;white-space:nowrap;vertical-align:middle;cursor:pointer;border:1px solid transparent;border-radius:4px;color:#fff;background-color:#22b24c;border-color:#22b24c}.btn:active,.btn.active{background-image:none;outline:0;box-shadow:inset 0 3px 5px rgba(0,0,0,0.125)}img.rnd{border:1px solid #ccc;border-radius:5px}.shot{border-radius:5px}.outl{border: 1px solid #ccc}.talk{margin-bottom:22px}@media (min-width:750px){.cn{width:730px}}@media (min-width:768px){.cn{width:750px}#full-toc{display:block}#mobile-toc{display:none}.c3,.c4,.c6,.c8,.c9,.c12{float:left}.c12{width:100%} .c9{width:75%} .c6{width:50%} .c8{width:66.66666666666666%} .c4{width:33.33333333333333%} .c3{width:25%} .co1{margin-left:8.333333333333332%} .select-next{min-height:300px}}@media (min-width:940px){.cn{width:920px}}@media (min-width:1140px){.cn{width:1120px}}.row{margin-right:-15px;margin-left:-15px} @media (max-width:767px){#full-toc{display:none} .hd{padding:8px 0 10px; margin:0} .hdt a,.hdt a:hover{font-size:34px} h1{font-size:28px} h2{font-size:24px} img.hdr{height:26px;width:26px} pre{font-size:60%}} @media (min-width:1140px){.select-next{min-height:220px}}</style><link rel="shortcut icon" href="/img/fsp-fav.png">
</head>
<body>
<div class="cn">
<div class="row"><div class="c12"><div class="hd"><a href="https://fullstackpython.qiwihui.com/"><img src="/img/logos/f.png" class="hdr" alt="Full Stack Python logo"></a><span class="hdt"> <a href="https://fullstackpython.qiwihui.com/">全栈 Python</a></span></div><div class="sns">
<a href="/table-of-contents.html">全部主题</a> <span class="bk">|</span>
<a href="/blog.html">博客</a> <span class="bk">|</span>
<a href="/email.html">邮件订阅</a> <span class="bk">|</span>
<a href="https://twitter.com/fullstackpython">@fullstackpython</a> <span class="bk">|</span>
<a href="https://www.facebook.com/fullstackpython">Facebook</a> <span class="bk">|</span>
<a href="/change-log.html">更新日志</a> <span class="bk">|</span>
<a href="https://github.com/qiwihui/fullstackpython.com">源码</a> 
</div></div></div><div class="row">
 <div class="c12">
  <h1 style="font-size: 36px;">使用 Bottle Web 应用程序拨打出站电话</h1>
  <div style="font-size:12px;color:#666;margin:0 0 10px">
     Post updated by <a href="/about-author.html">Matt Makai</a> on 
     June 16, 2017. Originally posted
     on August 30, 2016.
  </div>
 </div>
</div>
<div class="row">
  <div class="c9">
   <p>Python web apps built with the <a href="/bottle.html">Bottle web framework</a> can 
<a href="/blog/send-sms-text-messages-python.html">send</a> and 
<a href="/blog/reply-sms-text-messages-python-bottle.html">receive SMS text messages</a>.
In this tutorial we will go beyond texting and learn how to dial outbound 
phone calls. The calls will read a snippet of text then play an MP3 file,
but they can then be easily modified to create conference lines and many
other voice features in your Python web apps.</p>
<h2>Tools We Need</h2>
<p>You should have either <a href="/python-2-or-3.html">Python 2 or 3</a> installed to
create your Bottle app, although Python 3 is recommended for new 
applications. We also need:</p>
<ul>
<li><a href="https://pip.pypa.io/en/stable/">pip</a> and 
  <a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a> to handle
  <a href="/application-dependencies.html">application dependencies</a></li>
<li><a href="https://ngrok.com/">Ngrok</a> for localhost tunneling to our Bottle
  application while it's running on our local development environment</li>
<li><a href="/bottle.html">Bottle</a> web framework</li>
<li>Free <a href="https://www.twilio.com/try-twilio">Twilio account</a> to use their 
  <a href="https://www.twilio.com/docs/api/rest/making-calls">phone calling web API</a></li>
<li>Twilio's 
  <a href="https://www.twilio.com/docs/libraries/python">Python helper library</a>,
  which is <a href="https://github.com/twilio/twilio-python">open source on GitHub</a> 
  and <a href="https://pypi.org/project/twilio">available for download from PyPI</a></li>
</ul>
<p>Take a look at 
<a href="/blog/python-3-bottle-gunicorn-ubuntu-1604-xenial-xerus.html">this guide on setting up Python 3, Bottle and Gunicorn on Ubuntu 16.04 LTS</a>
if you need help getting your 
<a href="/development-environments.html">development environment</a> 
configured before continuing on through the remainder of this tutorial.</p>
<p>You can snag all the open source code for this tutorial in the 
<a href="https://github.com/mattmakai/python-bottle-phone">python-bottle-phone</a>
GitHub repository under the 
<a href="https://github.com/mattmakai/python-bottle-phone/tree/master/outbound-calls">outbound directory</a>. 
Use and copy the code however you want - it's all open source under the 
MIT license.</p>
<h2>Installing Our Application Dependencies</h2>
<p>Our Bottle app needs a helper code library to make it easy to dial outbound
phone calls. Bottle and the Twilio helper library are installable from 
<a href="https://pypi.python.org/pypi">PyPI</a> into a virtualenv. Open your terminal 
and use the <code>virtualenv</code> command to create a new virtualenv:</p>
<div class="highlight"><pre><span></span>virtualenv bottlephone
</pre></div>


<p>Use the <code>activate</code> script within the virtualenv, which makes this virtualenv
the active Python installation. Note that you need to do this in every 
terminal window that you want this virtualenv to be used.</p>
<div class="highlight"><pre><span></span>source bottlephone/bin/activate
</pre></div>


<p>The command prompt will change after activating the virtualenv
to something like <code>(bottlephone) $</code>. Here is a screenshot of what my
environment looked like when I used the <code>activate</code> script.</p>
<p><img src="/img/160830-phone-calls-bottle/activate-virtualenv.png" width="100%" class="technical-diagram img-rounded"></p>
<p>Next use the <code>pip</code> command to install the <a href="/bottle.html">Bottle</a> and 
<a href="https://www.twilio.com/docs/libraries/python">Twilio Python</a> packages
into your virtualenv.</p>
<div class="highlight"><pre><span></span>pip install bottle twilio==5.7.0
</pre></div>


<p>After the installation script finishes, we will have the required 
dependencies to build our app. Time to write some Python code to dial 
outbound phone calls.</p>
<h2>Bottle and Twilio</h2>
<p>Our simple Bottle web app will have three routes: </p>
<ul>
<li><code>/</code> - returns a text string to let us know our Bottle app is running</li>
<li><code>/twiml</code> - responds with <a href="https://www.twilio.com/docs/api/twiml">TwiML</a> 
  (a simple subset of XML) that instructs Twilio what to do when someone
  picks up the call to them from our Bottle web app</li>
<li><code>/dial-phone/&lt;outbound_phone_number&gt;</code>, where "outbound_phone_number" is
  a phone number in the format "+12025551234" - this route uses the Twilio
  helper library to send a POST request to the Twilio Voice API to dial a
  phone  call</li>
</ul>
<p>We can build the structure of our Bottle app and the first route right now.
Create a new file named <code>app.py</code> with the following contents to start our
app.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">bottle</span>
<span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">post</span><span class="p">,</span> <span class="n">Response</span>
<span class="kn">from</span> <span class="nn">twilio</span> <span class="kn">import</span> <span class="n">twiml</span>
<span class="kn">from</span> <span class="nn">twilio.rest</span> <span class="kn">import</span> <span class="n">TwilioRestClient</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">bottle</span><span class="o">.</span><span class="n">default_app</span><span class="p">()</span>
<span class="c1"># plug in account SID and auth token here if they are not already exposed as</span>
<span class="c1"># environment variables</span>
<span class="n">twilio_client</span> <span class="o">=</span> <span class="n">TwilioRestClient</span><span class="p">()</span>

<span class="n">TWILIO_NUMBER</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TWILIO_NUMBER&#39;</span><span class="p">,</span> <span class="s1">&#39;+12025551234&#39;</span><span class="p">)</span>
<span class="n">NGROK_BASE_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NGROK_BASE_URL&#39;</span><span class="p">,</span> <span class="s1">&#39;https://c6c6d4e8.ngrok.io&#39;</span><span class="p">)</span>


<span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a standard text response to show the app is up and running.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&quot;Bottle app running!&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">reloader</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>Make sure you are in the directory where you created the above <code>app.py</code>
file. Run the app via the Bottle development server with the following 
command. Make sure your virtualenv is still activated so our code can rely 
on the Bottle code library.</p>
<div class="highlight"><pre><span></span>python app.py
</pre></div>


<p>We should see a successful development server start up like this:</p>
<div class="highlight"><pre><span></span>(bottlephone) matt@ubuntu:~/bottlephone$ python app.py 
Bottle v0.12.9 server starting up (using WSGIRefServer())...
Listening on http://127.0.0.1:8000/
Hit Ctrl-C to quit.
</pre></div>


<p>Here is what the development server message looks like in my environment 
on Ubuntu:</p>
<p><img src="/img/160830-phone-calls-bottle/bottle-app-running.png" width="100%" class="technical-diagram img-rounded" alt="Successfully starting the Bottle development server from the command line."></p>
<p>Let's test out the app by going to "localhost:8000"
in the web browser. We should get a simple success message that the app
is running and responding to requests.</p>
<p><img src="/img/160830-phone-calls-bottle/bottle-app-web-browser.png" width="100%" class="technical-diagram img-rounded" alt="Simple success message in the web browser that the Bottle app is running."></p>
<p>Next we need to obtain a phone number that our Bottle app can use to 
call other phone numbers.</p>
<h2>Obtain a Phone Number</h2>
<p>Our basic Bottle web app is running but what we really want to do is dial
outbound calls - which will be handled by <a href="https://www.twilio.com/">Twilio</a>.</p>
<p>In your web browser go to the
<a href="https://www.twilio.com/try-twilio">Twilio website and sign up for a free account</a>. 
You can also sign into your existing Twilio account if you already have one.</p>
<p><img src="/img/160830-phone-calls-bottle/try-twilio.png" width="100%" class="technical-diagram img-rounded" alt="Twilio sign up screen."></p>
<p>The Twilio trial account allows you to dial and receive phone calls to 
your own validated phone number. To dial and receive calls from any phone 
number then you need to upgrade your account (hit the upgrade button on the
top navigation bar to do that). Trial accounts are great for initial 
development before your application goes live but upgraded accounts are where
the real power comes in.</p>
<p>Once you are signed into your Twilio account, go to the 
<a href="https://www.twilio.com/console/phone-numbers">manage phone numbers screen</a>.
On this screen you can 
<a href="https://www.twilio.com/console/phone-numbers/search">buy one or more phone numbers</a>
or click on an existing phone number in your account to configure it.</p>
<p><img src="/img/160830-phone-calls-bottle/manage-phone-numbers.png" width="100%" class="technical-diagram img-rounded" alt="Manage phone numbers screen."></p>
<p>There is nothing for us to configure right now on the phone number 
configuration page because we are making outbound phone calls for this 
tutorial. Now that we have a phone number in hand, let's add the final bit
of code to our Bottle app to get this app working.</p>
<h2>Making Phone Calls</h2>
<p>We need to add two new routes to our Bottle app so it can dial outbound
phone calls. Modify your existing app.py file with the two new functions
below, <code>twiml_response</code> and <code>outbound_call</code>. None of the other code in
this file needs to change other than adding those two new functions to
what we wrote in the previous section.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">bottle</span>
<span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">post</span><span class="p">,</span> <span class="n">Response</span>
<span class="kn">from</span> <span class="nn">twilio</span> <span class="kn">import</span> <span class="n">twiml</span>
<span class="kn">from</span> <span class="nn">twilio.rest</span> <span class="kn">import</span> <span class="n">TwilioRestClient</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">bottle</span><span class="o">.</span><span class="n">default_app</span><span class="p">()</span>
<span class="c1"># plug in account SID and auth token here if they are not already exposed as</span>
<span class="c1"># environment variables</span>
<span class="n">twilio_client</span> <span class="o">=</span> <span class="n">TwilioRestClient</span><span class="p">()</span>

<span class="c1"># add your Twilio phone number here</span>
<span class="n">TWILIO_NUMBER</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TWILIO_NUMBER&#39;</span><span class="p">,</span> <span class="s1">&#39;+16093002984&#39;</span><span class="p">)</span>
<span class="c1"># plug in your Ngrok Forwarding URL - we&#39;ll set it up in a minute</span>
<span class="n">NGROK_BASE_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NGROK_BASE_URL&#39;</span><span class="p">,</span> <span class="s1">&#39;https://c6c6d4e8.ngrok.io&#39;</span><span class="p">)</span>


<span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a standard text response to show the app is up and running.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&quot;Bottle app running!&quot;</span><span class="p">)</span>


<span class="nd">@post</span><span class="p">(</span><span class="s1">&#39;/twiml&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">twiml_response</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides TwiML instructions in response to a Twilio POST webhook</span>
<span class="sd">    event so that Twilio knows how to handle the outbound phone call</span>
<span class="sd">    when someone picks up the phone.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">twiml</span><span class="o">.</span><span class="n">Response</span><span class="p">()</span>
    <span class="n">response</span><span class="o">.</span><span class="n">say</span><span class="p">(</span><span class="s2">&quot;Sweet, this phone call is answered by your Bottle app!&quot;</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="s2">&quot;https://api.twilio.com/cowbell.mp3&quot;</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>


<span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/dial-phone/&lt;outbound_phone_number&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">outbound_call</span><span class="p">(</span><span class="n">outbound_phone_number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses the Twilio Python helper library to send a POST request to</span>
<span class="sd">    Twilio telling it to dial an outbound phone call from our specific</span>
<span class="sd">    Twilio phone number (that phone number must be owned by our Twilio </span>
<span class="sd">    account).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># the url must match the Ngrok Forwarding URL plus the route defined in</span>
    <span class="c1"># the previous function that responds with TwiML instructions</span>
    <span class="n">twilio_client</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">outbound_phone_number</span><span class="p">,</span> 
                               <span class="n">from_</span><span class="o">=</span><span class="n">BLOG_POST_NUMBER</span><span class="p">,</span>
                               <span class="n">url</span><span class="o">=</span><span class="n">NGROK_BASE_URL</span> <span class="o">+</span> <span class="s1">&#39;/twiml&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;phone call placed to &#39;</span> <span class="o">+</span> <span class="n">outbound_phone_number</span> <span class="o">+</span> <span class="s1">&#39;!&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">reloader</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>There is just one problem with our current setup if you're developing on
a local environment: Twilio won't be able to reach that <code>/twiml</code> route. 
We need to deploy our app to a reachable server, or just use a localhost 
tunneling tool like <a href="https://ngrok.com">Ngrok</a>. Ngrok provides an external
URL that connects to a port running on your machine. 
<a href="https://ngrok.com/download">Download and install the Ngrok application</a> 
that is appropriate for your operating system.</p>
<p>We run Ngrok locally and expose our Bottle app that is running on 
port 8000. Run this command within the directory where the Ngrok executable is
located.</p>
<div class="highlight"><pre><span></span>./ngrok http 8000
</pre></div>


<p>Ngrok will start up and provide us with a Forwarding URL, with both HTTP
and HTTPS versions.</p>
<p><img src="/img/160830-phone-calls-bottle/start-ngrok.png" width="100%" class="technical-diagram img-rounded" alt="Ngrok started and running to serve as a localhost tunnel."></p>
<p>We can use the Forwarding URL to instruct Twilio how to handle the outbound
phone call when someone picks up. Insert the Ngrok forwarding URL into the
<code>app.py</code> file where <code>NGROK_BASE_URL</code> is specified.</p>
<p><img src="/img/160830-phone-calls-bottle/access-ngrok.png" width="100%" class="technical-diagram img-rounded" alt="Paste the ngrok Forwarding URL into the Twilio webhook configuration text box."></p>
<p>If Ngrok is useful to you, make sure to read this 
<a href="https://www.twilio.com/blog/2015/09/6-awesome-reasons-to-use-ngrok-when-testing-webhooks.html">6 awesome reasons to use Ngrok when testing webhooks post</a> 
to learn even more about the tool.</p>
<p>Time to test out our app, let's give it a quick spin.</p>
<h2>Making Phone Calls</h2>
<p>Make sure your Bottle development server is still running or re-run it with
the <code>python app.py</code> command in a shell where your virtualenv is still
activated.</p>
<p>Bring up the application in a browser, this time test out the phone calling
capabilities. Go to "localhost:8000/dial-phone/my-phone-number", where 
"my-phone-number" is a number in the "+12025551234" format. For example,
here is what happens when I dialed +12023351278:</p>
<p><img src="/img/160830-phone-calls-bottle/phone-call-placed.png" width="100%" class="technical-diagram img-rounded" alt="Dialing an outbound phone call with Bottle."></p>
<p>And here is the inbound phone call!</p>
<p><img src="/img/160830-phone-calls-bottle/inbound-call.png" width="100%" class="technical-diagram img-rounded" alt="Receiving an incoming phone call on the iPhone."></p>
<p>When we pick up the phone call we also see the <code>/twiml</code> route get called via
Ngrok.</p>
<p><img src="/img/160830-phone-calls-bottle/ngrok-twiml.png" width="100%" class="technical-diagram img-rounded" alt="/twiml route being called via Ngrok."></p>
<p>With just two routes in our Bottle app and Twilio we were able to make
outbound phone calls. Not bad!</p>
<h2>What's next?</h2>
<p>Sweet, we can now dial outbound phone calls to <em>any</em> phone number from
our Bottle web application. Next you may want to try one of these tutorials 
to add even more features to your app:</p>
<ul>
<li>Upgrade your <a href="/blog/reply-sms-text-messages-python-bottle.html">Bottle app to also send and respond to text messages</a></li>
<li>Create a <a href="https://www.twilio.com/blog/2016/05/add-phone-calling-slack-python.html">phone-calling Slack bot</a></li>
<li>Implement <a href="https://www.twilio.com/docs/tutorials/walkthrough/call-tracking/python/django">call tracking</a>
  for both inbound and outbound phone calls made through your app</li>
</ul>
<p>Questions? Contact me via Twitter 
<a href="https://twitter.com/fullstackpython">@fullstackpython</a>
or <a href="https://twitter.com/mattmakai">@mattmakai</a>. I'm also on GitHub as
<a href="https://github.com/mattmakai">mattmakai</a>.</p>
<p>See something wrong in this post? Fork 
<a href="https://github.com/mattmakai/fullstackpython.com/blob/master/content/posts/160830-phone-calls-bottle.markdown">this page's source on GitHub</a>
and submit a pull request.</p>
   <hr>
<div id="mc_embed_signup">
<form action="//mattmakai.us2.list-manage.com/subscribe/post?u=b7e774f0c4f05dcebbfee183d&amp;id=b22335388d" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
 <div id="mc_embed_signup_scroll">
  <h4>Sign up for a monthly email with Full Stack Python tutorials. No spam ever.</h4>
  <div class="row">
   <div class="c9">
    <input type="email" value="" name="EMAIL" class="email form-control" id="mce-EMAIL" placeholder="email address" required>
    <div style="position: absolute; left: -5000px;"><input type="text" name="b_b7e774f0c4f05dcebbfee183d_b22335388d" tabindex="-1" value=""></div>
   </div>
   <div class="c3">
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="btn btn-success" style="font-family: 'Helvetica Neue'; margin-bottom:6px"></div>
   </div>
  </div>
 </div>
</form>
</div>  </div>
  <div class="c3">
<div class="pn">
 <div class="pnh">
  <h3>Learn more</h3>
 </div>
 <img src="/img/160830-phone-calls-bottle/header.jpg" alt="Bottle, Python 和 Twilio logos，版权归各自所有者所有。" width="100%"> 
 <div class="lg">
<a href="/web-frameworks.html" class="lgi">Web Frameworks</a>
<a href="/bottle.html" class="lgi">Bottle</a>
<a href="/application-programming-interfaces.html" class="lgi">APIs</a>
<a href="/api-integration.html" class="lgi">API Integration</a>
<a href="/twilio.html" class="lgi">Twilio API</a>
<a href="https://www.twilio.com/docs/" class="lgi">Twilio Docs <svg width="20" height="12" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1408 928v320q0 119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119 84.5-203.5t203.5-84.5h704q14 0 23 9t9 23v64q0 14-9 23t-23 9h-704q-66 0-113 47t-47 113v832q0 66 47 113t113 47h832q66 0 113-47t47-113v-320q0-14 9-23t23-9h64q14 0 23 9t9 23zm384-864v512q0 26-19 45t-45 19-45-19l-176-176-652 652q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l652-652-176-176q-19-19-19-45t19-45 45-19h512q26 0 45 19t19 45z"/></svg></a>  <a href="/table-of-contents.html" class="lgi">...or view all topics.</a>
 </div>
</div><div class="pn">
 <div class="pnh"><h3>Sponsored By</h3></div>
 <div class="pnb">
<a href="https://rollbar.com/"><img src="/img/logos/rbw.jpg" alt="Rollbar logo" width="100%" style="padding:12px 0 18px"></a>
<p class="sps">Fix errors in your Python code before your users see them by <a href="https://rollbar.com/">monitoring with Rollbar</a>.</p> </div>
</div>  </div>
</div>
<hr></div> 
<div style="margin: 0 0 12px;background-color: #22B24C;">
 <div class="cn">
  <p class="banner sns">
   <a href="https://training.talkpython.fm/courses/explore_ansible/introduction-to-ansible-with-python" style="color: #fff">Learn to deploy and configure servers with Ansible in my latest video course</a>!
  </p>
 </div>
</div>
<div class="container">
    <div class="footer pull-right" style="text-align:right; font-size:85%;">
        This site is based on <a href="https://github.com/mattmakai">Matt Makai</a>'s project <a href="https://github.com/mattmakai/fullstackpython.com">Full Stack Python</a>, thanks for his excellent work!
    </div>
</div>
<div class="container">
    <div class="footer pull-right" style="text-align:right; font-size:85%;">
        <p>此网站由 <a href="https://github.com/qiwihui">@qiwihui</a> 维护。
          若发现错误或想贡献，请访问： <a href="https://github.com/qiwihui/fullstackpython.com">Github qiwihui/fullstackpython.com 项目</a>
        </p>
    </div>
</div><script async src="https://www.googletagmanager.com/gtag/js?id=UA-46660488-4"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-46660488-4');</script>
</body>
</html>