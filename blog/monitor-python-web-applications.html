<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="了解如何使用托管监视服务（如Rollbar）将监视添加到Python Web应用程序。">
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="如何监控 Python web 应用程序" />
<meta name="twitter:image" content="https://www.fullstackpython.com/img/170926-monitor-python-web-apps/header.jpg" />
<meta name="twitter:site" content="@fullstackpython" />
<meta name="twitter:creator" content="@mattmakai" />
<meta property="og:url" content="https://www.fullstackpython.com/blog/monitor-python-web-applications.html" />
<meta property="og:title" content="如何监控 Python web 应用程序" />
<meta property="og:description" content="了解如何使用托管监视服务（如Rollbar）将监视添加到Python Web应用程序。 Great post on fullstackpython.com!" />
<meta property="og:image" content="https://www.fullstackpython.com/img/170926-monitor-python-web-apps/header.jpg" />
<link rel="canonical" href="https://www.fullstackpython.com/blog/monitor-python-web-applications.html" />
<title>如何监控 Python web 应用程序 - Full Stack Python</title> <style>hr,img{border:0}*,:after,:before{box-sizing:border-box}html{-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;font-size:18px;background:#fefefe}body{margin:0;font:18px Georgia,serif;line-height:1.4;color:#222;padding:0}img{vertical-align:middle}hr{height:0;box-sizing:content-box;margin:21px 0;border-top:1px solid #eee}h1,h2,h3,h4,h5,h6{font-family:"Helvetica Neue",sans-serif;font-weight:500;line-height:1.1;color:#000}h1,h2,h3{margin:32px 0 6px}h1{font-size:40px}h2{font-size:28px}h3{font-size:22px}h4,h5,h6{margin:11px 0;font-size:18px}p{margin:0 0 12px}ol,ul{margin:0 0 10px}code,pre{font:"Courier New",monospace;border-radius:4px;background-color:#f4f9ff;font-size:12px}code{padding:2px 4px;white-space:nowrap}pre{white-space:pre-wrap;display:block;padding:10px;margin:0 0 11px;line-height:1.4;word-break:break-all;word-wrap:break-word;border:1px solid #ccc}.cn{padding:0 15px 0 15px;margin-right:auto;margin-left:auto}.cn:before,.cn:after{display:table;content:" "}.cn:after{clear:both}.row:before,.row:after{display:table;content:" "}.row:after{clear:both}.c2,.c3,.c4,.c5,.c6,.c7,.c8,.c9,.c10,.c11,.c12{position:relative;min-height:1px;padding:0 15px 0 15px}a{background:transparent;text-decoration:none;border-bottom:1px dotted;color:#444}a:hover{text-decoration:none;color:#000}.ft{padding:0 0 24px;float:right}.sns{font-family:"Helvetica Neue",sans-serif}.sps{font-size:14px}.hd{margin:20px 0 15px 0}.hd>a{border-bottom:none}img.hdr{vertical-align:middle;border:none;height:52px;width:52px;padding:1px}.hdt a,.hdt a:hover{font:72px "Helvetica Neue",sans-serif;font-weight:normal;letter-spacing:.03em;vertical-align:middle;margin-left:5px;color:#000;text-decoration:none;border-bottom:none;line-height:.9em}.bk{margin:0 7px 0 7px}img.nob{border:none}.pn{margin:0 0 21px;background:#fff;border:1px solid transparent;border-radius:4px;border-color:#22b24c}.pnb{padding:15px}.pnb:before,.pnb:after{display:table;content:" "}.pnb:after{clear:both}.pn>.lg{margin-bottom:0}.pn>.lg .lgi{border-width:1px 0;font:14px 'Helvetica Neue',sans-serif;padding:5px 0 5px 10px}.pn>.lg .lgi:first-child{border-top-right-radius:0;border-top-left-radius:0}.pn>.lg .lgi:last-child{border-bottom:0;background-color:#22b24c;color:#fff}.pnh+.lg .lgi:first-child{border-top-width:0}.pnh{padding:10px 15px;border-bottom:1px solid transparent;border-top-right-radius:3px;border-top-left-radius:3px;color:#468847;background-color:#22b24c;border-color:#22b24c}.pn>.pnh>h3{margin:5px 0 0 0;color:#fff}.pn>.pnh>h3>a{color:#fff}.pn>.lg a.lgi.sbc{padding-left:27px}.pn>.lg a.lgi.sbc2{padding-left:35px}#sb{margin-top:40px}.lg{padding-left:0;margin-bottom:20px}.lgi{position:relative;display:block;padding:10px 15px;margin-bottom:-1px;background-color:#fff;border:1px solid #ddd}.lgi:first-child{border-top-right-radius:4px;border-top-left-radius:4px}.lgi:last-child{margin-bottom:0;border-bottom-right-radius:4px;border-bottom-left-radius:4px}a.lgi{color:#333}a.lgi:hover,a.lgi:focus{background:#ddd}a.lgi.active{z-index:2;background:#444;color:#fff;border:1px solid #222}.btn-full{width:100%;box-shadow:1px 2px 1px #222;padding-bottom:4px}p.under-btn{text-align:left;margin-top:20px}p.banner{font-weight:500;line-height:1.1;color:#fff;font-size:22px;margin:14px 0 18px 0}th{text-align:left;font-family:"Helvetica Neue",sans-serif}td{padding-right:20px}blockquote{border-left:4px solid #aaa;padding-left:10px;font-family:"Helvetica Neue"}.well{min-height:20px;padding:19px;margin:0 0 20px;background-color:#f5f5f5;border:1px solid #e3e3e3;border-radius:4px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.05)}.see-also{margin-top:20px;background:#22B24C;color:#eee;font-family:"Helvetica Neue",sans-serif}.see-also a{color: #fff}.highlight{background:#ffff00}.form-control{display:block;width:100%;height:39px;padding:8px 12px;font-size:14px;color:#777;vertical-align:middle;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:4px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.075);transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}.form-control:focus{border-color:#66afe9;outline:0;box-shadow:inset 0 1px 1px rgba(0,0,0,0.075),0 0 8px rgba(102,175,233,0.6)}.btn{display:inline-block;padding:8px 12px;margin-bottom:0;font-size:15px;line-height:1.4;text-align:center;white-space:nowrap;vertical-align:middle;cursor:pointer;border:1px solid transparent;border-radius:4px;color:#fff;background-color:#22b24c;border-color:#22b24c}.btn:active,.btn.active{background-image:none;outline:0;box-shadow:inset 0 3px 5px rgba(0,0,0,0.125)}img.rnd{border:1px solid #ccc;border-radius:5px}.shot{border-radius:5px}.outl{border: 1px solid #ccc}.talk{margin-bottom:22px}@media (min-width:750px){.cn{width:730px}}@media (min-width:768px){.cn{width:750px}#full-toc{display:block}#mobile-toc{display:none}.c3,.c4,.c6,.c8,.c9,.c12{float:left}.c12{width:100%} .c9{width:75%} .c6{width:50%} .c8{width:66.66666666666666%} .c4{width:33.33333333333333%} .c3{width:25%} .co1{margin-left:8.333333333333332%} .select-next{min-height:300px}}@media (min-width:940px){.cn{width:920px}}@media (min-width:1140px){.cn{width:1120px}}.row{margin-right:-15px;margin-left:-15px} @media (max-width:767px){#full-toc{display:none} .hd{padding:8px 0 10px; margin:0} .hdt a,.hdt a:hover{font-size:34px} h1{font-size:28px} h2{font-size:24px} img.hdr{height:26px;width:26px} pre{font-size:60%}} @media (min-width:1140px){.select-next{min-height:220px}}</style><link rel="shortcut icon" href="/img/fsp-fav.png">
</head>
<body>
<div class="cn">
<div class="row"><div class="c12"><div class="hd"><a href="https://fullstackpython.qiwihui.com/"><img src="/img/logos/f.png" class="hdr" alt="Full Stack Python logo"></a><span class="hdt"> <a href="https://fullstackpython.qiwihui.com/">全栈 Python</a></span></div><div class="sns">
<a href="/table-of-contents.html">全部主题</a> <span class="bk">|</span>
<a href="/blog.html">博客</a> <span class="bk">|</span>
<a href="/email.html">邮件订阅</a> <span class="bk">|</span>
<a href="https://twitter.com/fullstackpython">@fullstackpython</a> <span class="bk">|</span>
<a href="https://www.facebook.com/fullstackpython">Facebook</a> <span class="bk">|</span>
<a href="/change-log.html">更新日志</a> <span class="bk">|</span>
<a href="https://github.com/qiwihui/fullstackpython.com">源码</a> 
</div></div></div><div class="row">
 <div class="c12">
  <h1 style="font-size: 36px;">如何监控 Python web 应用程序</h1>
  <div style="font-size:12px;color:#666;margin:0 0 10px">
     Post updated by <a href="/about-author.html">Matt Makai</a> on 
     September 29, 2017. Originally posted
     on September 26, 2017.
  </div>
 </div>
</div>
<div class="row">
  <div class="c9">
   <p>A quick way to check for errors and issues in your operational 
<a href="/web-development.html">Python web application</a> is to drop-in one of many
awesome hosted <a href="/monitoring.html">monitoring</a> tools.</p>
<p>Let's learn to quickly add <a href="https://rollbar.com">Rollbar monitoring</a>
to a web app to visualize when our application is running properly and
when it has issues. This tutorial will use <a href="/bottle.html">Bottle</a> as the 
example <a href="/web-frameworks.html">web framework</a> along with Rollbar as the 
monitoring service but you can also check out the list of other tools 
on the <a href="/monitoring.html">monitoring page</a>.</p>
<h2>Our Tools</h2>
<p>We can use either <a href="/python-2-or-3.html">Python 2 or 3</a> to build this
tutorial, but Python 3 is <em>strongly</em> recommended for all new applications. 
<a href="https://www.python.org/downloads/release/python-362/">Python 3.6.2</a> 
was used to build this tutorial. We will also use the following 
<a href="/application-dependencies.html">application dependencies</a> throughout
the post: </p>
<ul>
<li><a href="https://pip.pypa.io/en/stable/">pip</a> and 
  <a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a>, which come installed 
  with Python 3, to install and isolate the Bottle and Rollbar libraries 
  from your other projects</li>
<li><a href="/bottle.html">Bottle</a> web framework, 
  <a href="https://bottlepy.org/docs/0.12/">version 0.12.13</a></li>
<li><a href="https://rollbar.com/docs/notifier/pyrollbar/">pyrollbar</a> monitoring 
  instrumentation library,
  <a href="https://github.com/rollbar/pyrollbar/tree/v0.13.13">version 0.13.13</a>
  in Bottle applications so pyrollbar can report on all errors</li>
<li>A <a href="https://rollbar.com/">free Rollbar account</a> where we will send error
  data and view it when it is captured</li>
</ul>
<p>If you need help getting your 
<a href="/development-environments.html">development environment</a> configured
before running this code, take a look at
<a href="/blog/python-3-bottle-gunicorn-ubuntu-1604-xenial-xerus.html">this guide for setting up Python 3 and Bottle on Ubuntu 16.04 LTS</a>.</p>
<p>All code in this blog post is available open source under the MIT license 
on GitHub under the 
<a href="https://github.com/fullstackpython/blog-code-examples">monitor-python-bottle-apps directory of the blog-code-examples repository</a>. 
Use and abuse the source code as you desire for your own applications.</p>
<h2>Installing Dependencies</h2>
<p>Create a new virtual environment for this project using the following
command. I recommend keeping a separate directory for virtualenvs under 
<code>~/Envs/</code> so you will know where all your project virtualenvs are located.</p>
<div class="highlight"><pre><span></span>python3 -m venv monitorpython
</pre></div>


<p>Activate the virtualenv with the <code>activate</code> shell script:</p>
<div class="highlight"><pre><span></span><span class="nb">source</span> monitorpython/bin/activate
</pre></div>


<p>The command prompt will change after activating the virtualenv:</p>
<p><img src="/img/170926-monitor-python-web-apps/activate-python-virtualenv.png" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="Activating our Python virtual environment on the command line."></p>
<p>Remember that you need to activate your virtualenv in every new terminal 
window where you want to use the virtualenv to run the project.</p>
<p>We can now install Bottle and Rollbar into the activated
virtualenv.</p>
<div class="highlight"><pre><span></span>pip install bottle==0.12.13 rollbar==0.13.13
</pre></div>


<p>Look for output like the following to confirm the 
dependencies installed correctly.</p>
<div class="highlight"><pre><span></span>Installing collected packages: bottle, urllib3, certifi, idna, chardet, requests, six, rollbar
  Running setup.py install for bottle ... done
    Running setup.py install for rollbar ... done
    Successfully installed bottle-0.12.13 certifi-2017.7.27.1 chardet-3.0.4 idna-2.6 requests-2.18.4 rollbar-0.13.13 six-1.11.0 urllib3-1.22
</pre></div>


<p>We have our dependencies ready to go so now we can build
our Python web application.</p>
<h2>Our Python Web App</h2>
<p>Create a folder for your project named <code>monitor-python-apps</code>. <code>cd</code> into
the folder and then create a file named <code>app.py</code> with the following
code.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bottle</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">template</span>


<span class="n">TEMPLATE_STRING</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;html&gt;</span>
<span class="s2"> &lt;head&gt;</span>
<span class="s2">  &lt;title&gt;Full Stack Python Web App&lt;/title&gt;</span>
<span class="s2"> &lt;/head&gt;</span>
<span class="s2"> &lt;body&gt;</span>
<span class="s2">  &lt;h1&gt;{{ h1 }}&lt;/h1&gt;</span>
<span class="s2"> &lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">MIN_MSG_LENGTH</span> <span class="o">=</span> <span class="mi">2</span>


<span class="nd">@route</span><span class="p">(</span><span class="s2">&quot;/&lt;msg&gt;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_message</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display a message if the msg value is greater than 2 characters</span>
<span class="sd">    in the path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valid_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">MIN_MSG_LENGTH</span>
    <span class="n">valid_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;^[a-z\-]+$&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">valid_length</span> <span class="ow">and</span> <span class="n">valid_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="n">TEMPLATE_STRING</span><span class="p">,</span> <span class="n">h1</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;Sorry, only alpha characters and hyphens allowed.&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">bottle</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
</pre></div>


<p>The above application code has a few standard Bottle imports so we can
create a Bottle web app and handle URL routes. </p>
<p>We have a single function, <code>show_message</code>, that handles a single Bottle 
URL route. <code>show_message</code> checks if the URL path contains only alphabetic 
characters and hyphens for a message to display. If the message passes 
the conditions then a page is rendered with that message
in an <code>h1</code> element. If <code>msg</code> does not pass the condition test then an 
exception is thrown that only alpha characters and hyphens are allowed.</p>
<p>Save <code>app.py</code> and we can run our code. Execute <code>app.py</code> using the <code>python</code>
command as follows (make sure your virtualenv is still activated in the
terminal where you are running this command):</p>
<div class="highlight"><pre><span></span>python app.py
</pre></div>


<p>The Bottle development server should start up and display a few lines
of output.</p>
<p><img src="/img/170926-monitor-python-web-apps/run-bottle-app.png" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="Run the local Bottle development server."></p>
<p>Try to access a URL with a path that contains only alphabetic characters and 
hyphens, such as 
<a href="http://localhost:8080/hello-world/">localhost:8080/hello-world/</a>.</p>
<p><img src="/img/170926-monitor-python-web-apps/localhost-hello-world.png" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="Testing at /hello-world/ returns an HTTP 200 response."></p>
<p>The application was successful in displaying "hello-world" but what if we
try a URL that contains numbers in addition to the alphabetic characters,
such as
<a href="http://localhost:8080/fullstackpython/">localhost:8080/fullstackpython123/</a>?</p>
<p><img src="/img/170926-monitor-python-web-apps/localhost-500.png" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="We receive a 500 error when numbers are added to the URL."></p>
<p>An HTTP 500 error. That is surely not a good user experience.</p>
<p>The 500 error is obvious to us right now because we are 
testing the application locally during development. However, what happens 
when the app is deployed and a user gets the error in their own web 
browser? They will likely quit out of frustration and you will never 
know what happened unless you add some error tracking and application 
monitoring.</p>
<p>Time to modify our code to add Rollbar to report errors that occur.</p>
<h2>Monitoring for Errors with Rollbar</h2>
<p>Go to the <a href="https://rollbar.com/">Rollbar homepage in your browser</a> 
to add their tool to our Bottle app.</p>
<p><img src="/img/170926-monitor-python-web-apps/rollbar-homepage.jpg" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="The Rollbar homepage in the Chrome web browser."></p>
<p>Click the "Sign Up" button in the upper right-hand corner. Enter your 
email address, a username and the password you want on the sign up page.</p>
<p><img src="/img/170926-monitor-python-web-apps/sign-up-page.jpg" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="Enter your account information on the sign up page."></p>
<p>After the sign up page you will see the onboarding flow where you can
enter a project name and select a programming language. For the project
name type in "Full Stack Python" then select that you are monitoring a 
Python app.</p>
<p><img src="/img/170926-monitor-python-web-apps/create-new-project.jpg" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="Create a new project named 'Battlegrounds' and select Python as the programming language."></p>
<p>Press the "Continue" button at the bottom to move along. The next
screen shows us a few instructions to add monitoring to a Python
application.</p>
<p><img src="/img/170723-monitor-flask-apps/project-setup.jpg" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="Set up your project using your server-side access token."></p>
<p>Let's change our Bottle code to let Rollbar collect and aggregate the
errors that pop up in our application. Modify <code>app.py</code> to include the 
following highlighted lines. </p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bottle</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">template</span>
<span class="highlight"><span class="o"></span><span class="kn">from</span> <span class="nn">rollbar.contrib.bottle</span> <span class="kn">import</span> <span class="n">RollbarBottleReporter</span></span>


<span class="n">TEMPLATE_STRING</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;html&gt;</span>
<span class="s2"> &lt;head&gt;</span>
<span class="s2">  &lt;title&gt;Full Stack Python Web App&lt;/title&gt;</span>
<span class="s2"> &lt;/head&gt;</span>
<span class="s2"> &lt;body&gt;</span>
<span class="s2">  &lt;h1&gt;{{ h1 }}&lt;/h1&gt;</span>
<span class="s2"> &lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">MIN_MSG_LENGTH</span> <span class="o">=</span> <span class="mi">2</span>
<span class="highlight"><span class="o"></span><span class="n">ROLLBAR_SECRET</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ROLLBAR_SECRET&quot;</span><span class="p">)</span></span>
<span class="highlight"><span class="o"></span></span>
<span class="highlight"><span class="o"></span><span class="n">rb_monitor</span> <span class="o">=</span> <span class="n">RollbarBottleReporter</span><span class="p">(</span><span class="n">access_token</span><span class="o">=</span><span class="n">ROLLBAR_SECRET</span><span class="p">,</span></span>
<span class="highlight"><span class="o"></span>                                   <span class="n">environment</span><span class="o">=</span><span class="s1">&#39;production&#39;</span><span class="p">)</span></span>
<span class="highlight"><span class="o"></span><span class="n">bottle</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">rb_monitor</span><span class="p">)</span></span>


<span class="nd">@route</span><span class="p">(</span><span class="s2">&quot;/&lt;msg&gt;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_message</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display a message if the msg value is greater than 2 characters</span>
<span class="sd">    in the path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valid_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">MIN_MSG_LENGTH</span>
    <span class="n">valid_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;^[a-z\-]+$&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">valid_length</span> <span class="ow">and</span> <span class="n">valid_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="n">TEMPLATE_STRING</span><span class="p">,</span> <span class="n">h1</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;Sorry, only alpha characters and hyphens allowed.&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">bottle</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
</pre></div>


<p>A new import <code>from rollbar.contrib.bottle import RollbarBottleReporter</code>
is our conduit between the application and the Rollbar server. <code>rollbar</code>
is the library we installed earlier. </p>
<p>The <code>ROLLBAR_SECRET</code> token needs to be set in an environment variable.
Save and quit <code>app.py</code>. Run the following command in the terminal where your
virtualenv is activated:</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">ROLLBAR_SECRET</span><span class="o">=</span><span class="s1">&#39;token here&#39;</span>
</pre></div>


<p>If you are uncertain about what your secret token is, it can be found on 
the Rollbar onboarding screen. </p>
<p>Note that I typically store all my environment variables in a <code>.env</code> 
file and use a 
<a href="https://github.com/fullstackpython/blog-code-examples/blob/master/monitor-flask-apps/template.env">template.env</a> 
as a template for what I should fill into <code>.env</code>. <code>.env</code> can be invoked
from the terminal using the <code>. .env</code> command. Make sure to <em>never</em> commit 
your secret tokens to a source control repository though, especially if 
the repository is public!</p>
<p>After exporting your <code>ROLLBAR_SECRET</code> key as an environment variable
we can test that Rollbar is working as we run our application. Run it
now using <code>python</code>:</p>
<div class="highlight"><pre><span></span>python app.py
</pre></div>


<p>Back in your web browser press the "Done! Go to Dashboard" button.</p>
<p>If an event hasn't been reported yet we'll see a waiting screen like this
one:</p>
<p><img src="/img/170926-monitor-python-web-apps/waiting.jpg" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="Waiting for data on the Rollbar dashboard."></p>
<p>Make sure your Bottle development server is running and try to go to 
<a href="http://localhost:8080/fullstackpython123/">localhost:8080/fullstackpython123/</a>.
A 500 server error is immediately reported on the dashboard:</p>
<p><img src="/img/170926-monitor-python-web-apps/exception-reported.jpg" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="Viewing the 500 errors reported in the Rollbar dashboard."></p>
<p>We even get an email with the error (which can also be turned off if you
don't want emails for every error):</p>
<p><img src="/img/170926-monitor-python-web-apps/email-error-report.jpg" width="100%" class="technical-diagram img-rounded" style="border:1px solid #ccc" alt="Email with the Rollbar error report."></p>
<p>Nice, with just a few lines of code we now have our Bottle app reporting
errors for any user that's working with our application.</p>
<h2>What now?</h2>
<p>We just learned how to catch and handle errors with Rollbar as a hosted
monitoring platform in a simple example 
<a href="/bottle.html">Bottle application</a>. Next you will want to 
add <a href="/monitoring.html">monitoring</a> to more complicated web apps, including
ones that use <a href="/django.html">Django</a> or <a href="/flask.html">Flask</a>. You can also 
try Rollbar's more advanced features to:</p>
<ul>
<li><a href="https://rollbar.com/docs/custom-grouping/">set up rules to group errors</a></li>
<li><a href="https://rollbar.com/docs/deploy-tracking/">debug and track deployment issues</a></li>
<li><a href="https://rollbar.com/docs/person-tracking/">sort and view errors by user</a></li>
</ul>
<p>There is plenty more to learn about in the areas of 
<a href="/web-development.html">web development</a> and 
<a href="/deployments.html">deployments</a> so keep learning by reading 
about <a href="/web-frameworks.html">web frameworks</a>. You can also learn more 
about integrating Rollbar with Python applications via 
<a href="https://rollbar.com/docs/notifier/pyrollbar/">their Python documentation</a>.</p>
<p>Questions? Let me know via 
<a href="https://github.com/mattmakai/fullstackpython.com/issues">a GitHub issue ticket on the Full Stack Python repository</a>, 
on Twitter 
<a href="https://twitter.com/fullstackpython">@fullstackpython</a>
or <a href="https://twitter.com/mattmakai">@mattmakai</a>.</p>
<p>Do you see a typo, syntax issue or just something that's confusing in this 
blog post? Fork
<a href="https://github.com/mattmakai/fullstackpython.com/blob/master/content/posts/170926-monitor-python-web-apps.markdown">this page's source on GitHub</a>
and submit a pull request with a fix or 
<a href="https://github.com/mattmakai/fullstackpython.com/issues">file an issue ticket on GitHub</a>.</p>
   <hr>
<div id="mc_embed_signup">
<form action="//mattmakai.us2.list-manage.com/subscribe/post?u=b7e774f0c4f05dcebbfee183d&amp;id=b22335388d" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
 <div id="mc_embed_signup_scroll">
  <h4>Sign up for a monthly email with Full Stack Python tutorials. No spam ever.</h4>
  <div class="row">
   <div class="c9">
    <input type="email" value="" name="EMAIL" class="email form-control" id="mce-EMAIL" placeholder="email address" required>
    <div style="position: absolute; left: -5000px;"><input type="text" name="b_b7e774f0c4f05dcebbfee183d_b22335388d" tabindex="-1" value=""></div>
   </div>
   <div class="c3">
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="btn btn-success" style="font-family: 'Helvetica Neue'; margin-bottom:6px"></div>
   </div>
  </div>
 </div>
</form>
</div>  </div>
  <div class="c3">
<div class="pn">
 <div class="pnh">
  <h3>Learn more</h3>
 </div>
 <img src="/img/170926-monitor-python-web-apps/header.jpg" alt="Python, Rollbar 和 Bottle logos。版权归各自所有者所有。" width="100%"> 
 <div class="lg">
<a href="/web-frameworks.html" class="lgi">Web Frameworks</a>
<a href="/bottle.html" class="lgi">Bottle</a>
<a href="/deployment.html" class="lgi">Deployment</a>
<a href="/wsgi-servers.html" class="lgi">WSGI Servers</a>
<a href="/green-unicorn-gunicorn.html" class="lgi">Green Unicorn (Gunicorn)</a>
<a href="/monitoring.html" class="lgi">Monitoring</a>
<a href="https://rollbar.com" class="lgi">Rollbar <svg width="20" height="12" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1408 928v320q0 119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119 84.5-203.5t203.5-84.5h704q14 0 23 9t9 23v64q0 14-9 23t-23 9h-704q-66 0-113 47t-47 113v832q0 66 47 113t113 47h832q66 0 113-47t47-113v-320q0-14 9-23t23-9h64q14 0 23 9t9 23zm384-864v512q0 26-19 45t-45 19-45-19l-176-176-652 652q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l652-652-176-176q-19-19-19-45t19-45 45-19h512q26 0 45 19t19 45z"/></svg></a>  <a href="/table-of-contents.html" class="lgi">...or view all topics.</a>
 </div>
</div><div class="pn">
 <div class="pnh"><h3>Sponsored By</h3></div>
 <div class="pnb">
<a href="https://rollbar.com/"><img src="/img/logos/rbw.jpg" alt="Rollbar logo" width="100%" style="padding:12px 0 18px"></a>
<p class="sps">Fix errors in your Python code before your users see them by <a href="https://rollbar.com/">monitoring with Rollbar</a>.</p> </div>
</div>  </div>
</div>
<hr></div> 
<div style="margin: 0 0 12px;background-color: #22B24C;">
 <div class="cn">
  <p class="banner sns">
   <a href="https://training.talkpython.fm/courses/explore_ansible/introduction-to-ansible-with-python" style="color: #fff">Learn to deploy and configure servers with Ansible in my latest video course</a>!
  </p>
 </div>
</div>
<div class="container">
    <div class="footer pull-right" style="text-align:right; font-size:85%;">
        This site is based on <a href="https://github.com/mattmakai">Matt Makai</a>'s project <a href="https://github.com/mattmakai/fullstackpython.com">Full Stack Python</a>, thanks for his excellent work!
    </div>
</div>
<div class="container">
    <div class="footer pull-right" style="text-align:right; font-size:85%;">
        <p>此网站由 <a href="https://github.com/qiwihui">@qiwihui</a> 维护。
          若发现错误或想贡献，请访问： <a href="https://github.com/qiwihui/fullstackpython.com">Github qiwihui/fullstackpython.com 项目</a>
        </p>
    </div>
</div><script async src="https://www.googletagmanager.com/gtag/js?id=UA-46660488-4"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-46660488-4');</script>
</body>
</html>