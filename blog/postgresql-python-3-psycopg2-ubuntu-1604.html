<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="在 Ubuntu 16.04 Xenial Xerus 上安装和使用 PostgreSQL 与 Python 3 和 psycopg2 的指南。">
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="在 Ubuntu 16.04 上使用 Python 3 和 psycopg 设置 PostgreSQL" />
<meta name="twitter:image" content="https://www.fullstackpython.com/img/160518-postgresql-ubuntu-1604/header.jpg" />
<meta name="twitter:site" content="@fullstackpython" />
<meta name="twitter:creator" content="@mattmakai" />
<meta property="og:url" content="https://www.fullstackpython.com/blog/postgresql-python-3-psycopg2-ubuntu-1604.html" />
<meta property="og:title" content="在 Ubuntu 16.04 上使用 Python 3 和 psycopg 设置 PostgreSQL" />
<meta property="og:description" content="在 Ubuntu 16.04 Xenial Xerus 上安装和使用 PostgreSQL 与 Python 3 和 psycopg2 的指南。 Great post on fullstackpython.com!" />
<meta property="og:image" content="https://www.fullstackpython.com/img/160518-postgresql-ubuntu-1604/header.jpg" />
<link rel="canonical" href="https://www.fullstackpython.com/blog/postgresql-python-3-psycopg2-ubuntu-1604.html" />
<title>在 Ubuntu 16.04 上使用 Python 3 和 psycopg 设置 PostgreSQL - Full Stack Python</title> <style>hr,img{border:0}*,:after,:before{box-sizing:border-box}html{-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;font-size:18px;background:#fefefe}body{margin:0;font:18px Georgia,serif;line-height:1.4;color:#222;padding:0}img{vertical-align:middle}hr{height:0;box-sizing:content-box;margin:21px 0;border-top:1px solid #eee}h1,h2,h3,h4,h5,h6{font-family:"Helvetica Neue",sans-serif;font-weight:500;line-height:1.1;color:#000}h1,h2,h3{margin:32px 0 6px}h1{font-size:40px}h2{font-size:28px}h3{font-size:22px}h4,h5,h6{margin:11px 0;font-size:18px}p{margin:0 0 12px}ol,ul{margin:0 0 10px}code,pre{font:"Courier New",monospace;border-radius:4px;background-color:#f4f9ff;font-size:12px}code{padding:2px 4px;white-space:nowrap}pre{white-space:pre-wrap;display:block;padding:10px;margin:0 0 11px;line-height:1.4;word-break:break-all;word-wrap:break-word;border:1px solid #ccc}.cn{padding:0 15px 0 15px;margin-right:auto;margin-left:auto}.cn:before,.cn:after{display:table;content:" "}.cn:after{clear:both}.row:before,.row:after{display:table;content:" "}.row:after{clear:both}.c2,.c3,.c4,.c5,.c6,.c7,.c8,.c9,.c10,.c11,.c12{position:relative;min-height:1px;padding:0 15px 0 15px}a{background:transparent;text-decoration:none;border-bottom:1px dotted;color:#444}a:hover{text-decoration:none;color:#000}.ft{padding:0 0 24px;float:right}.sns{font-family:"Helvetica Neue",sans-serif}.sps{font-size:14px}.hd{margin:20px 0 15px 0}.hd>a{border-bottom:none}img.hdr{vertical-align:middle;border:none;height:52px;width:52px;padding:1px}.hdt a,.hdt a:hover{font:72px "Helvetica Neue",sans-serif;font-weight:normal;letter-spacing:.03em;vertical-align:middle;margin-left:5px;color:#000;text-decoration:none;border-bottom:none;line-height:.9em}.bk{margin:0 7px 0 7px}img.nob{border:none}.pn{margin:0 0 21px;background:#fff;border:1px solid transparent;border-radius:4px;border-color:#22b24c}.pnb{padding:15px}.pnb:before,.pnb:after{display:table;content:" "}.pnb:after{clear:both}.pn>.lg{margin-bottom:0}.pn>.lg .lgi{border-width:1px 0;font:14px 'Helvetica Neue',sans-serif;padding:5px 0 5px 10px}.pn>.lg .lgi:first-child{border-top-right-radius:0;border-top-left-radius:0}.pn>.lg .lgi:last-child{border-bottom:0;background-color:#22b24c;color:#fff}.pnh+.lg .lgi:first-child{border-top-width:0}.pnh{padding:10px 15px;border-bottom:1px solid transparent;border-top-right-radius:3px;border-top-left-radius:3px;color:#468847;background-color:#22b24c;border-color:#22b24c}.pn>.pnh>h3{margin:5px 0 0 0;color:#fff}.pn>.pnh>h3>a{color:#fff}.pn>.lg a.lgi.sbc{padding-left:27px}.pn>.lg a.lgi.sbc2{padding-left:35px}#sb{margin-top:40px}.lg{padding-left:0;margin-bottom:20px}.lgi{position:relative;display:block;padding:10px 15px;margin-bottom:-1px;background-color:#fff;border:1px solid #ddd}.lgi:first-child{border-top-right-radius:4px;border-top-left-radius:4px}.lgi:last-child{margin-bottom:0;border-bottom-right-radius:4px;border-bottom-left-radius:4px}a.lgi{color:#333}a.lgi:hover,a.lgi:focus{background:#ddd}a.lgi.active{z-index:2;background:#444;color:#fff;border:1px solid #222}.btn-full{width:100%;box-shadow:1px 2px 1px #222;padding-bottom:4px}p.under-btn{text-align:left;margin-top:20px}p.banner{font-weight:500;line-height:1.1;color:#fff;font-size:22px;margin:14px 0 18px 0}th{text-align:left;font-family:"Helvetica Neue",sans-serif}td{padding-right:20px}blockquote{border-left:4px solid #aaa;padding-left:10px;font-family:"Helvetica Neue"}.well{min-height:20px;padding:19px;margin:0 0 20px;background-color:#f5f5f5;border:1px solid #e3e3e3;border-radius:4px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.05)}.see-also{margin-top:20px;background:#22B24C;color:#eee;font-family:"Helvetica Neue",sans-serif}.see-also a{color: #fff}.highlight{background:#ffff00}.form-control{display:block;width:100%;height:39px;padding:8px 12px;font-size:14px;color:#777;vertical-align:middle;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:4px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.075);transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}.form-control:focus{border-color:#66afe9;outline:0;box-shadow:inset 0 1px 1px rgba(0,0,0,0.075),0 0 8px rgba(102,175,233,0.6)}.btn{display:inline-block;padding:8px 12px;margin-bottom:0;font-size:15px;line-height:1.4;text-align:center;white-space:nowrap;vertical-align:middle;cursor:pointer;border:1px solid transparent;border-radius:4px;color:#fff;background-color:#22b24c;border-color:#22b24c}.btn:active,.btn.active{background-image:none;outline:0;box-shadow:inset 0 3px 5px rgba(0,0,0,0.125)}img.rnd{border:1px solid #ccc;border-radius:5px}.shot{border-radius:5px}.outl{border: 1px solid #ccc}.talk{margin-bottom:22px}@media (min-width:750px){.cn{width:730px}}@media (min-width:768px){.cn{width:750px}#full-toc{display:block}#mobile-toc{display:none}.c3,.c4,.c6,.c8,.c9,.c12{float:left}.c12{width:100%} .c9{width:75%} .c6{width:50%} .c8{width:66.66666666666666%} .c4{width:33.33333333333333%} .c3{width:25%} .co1{margin-left:8.333333333333332%} .select-next{min-height:300px}}@media (min-width:940px){.cn{width:920px}}@media (min-width:1140px){.cn{width:1120px}}.row{margin-right:-15px;margin-left:-15px} @media (max-width:767px){#full-toc{display:none} .hd{padding:8px 0 10px; margin:0} .hdt a,.hdt a:hover{font-size:34px} h1{font-size:28px} h2{font-size:24px} img.hdr{height:26px;width:26px} pre{font-size:60%}} @media (min-width:1140px){.select-next{min-height:220px}}</style><link rel="shortcut icon" href="/img/fsp-fav.png">
</head>
<body>
<div class="cn">
<div class="row"><div class="c12"><div class="hd"><a href="https://fullstackpython.qiwihui.com/"><img src="/img/logos/f.png" class="hdr" alt="Full Stack Python logo"></a><span class="hdt"> <a href="https://fullstackpython.qiwihui.com/">全栈 Python</a></span></div><div class="sns">
<a href="/table-of-contents.html">全部主题</a> <span class="bk">|</span>
<a href="/blog.html">博客</a> <span class="bk">|</span>
<a href="/email.html">邮件订阅</a> <span class="bk">|</span>
<a href="https://twitter.com/fullstackpython">@fullstackpython</a> <span class="bk">|</span>
<a href="https://www.facebook.com/fullstackpython">Facebook</a> <span class="bk">|</span>
<a href="/change-log.html">更新日志</a> <span class="bk">|</span>
<a href="https://github.com/qiwihui/fullstackpython.com">源码</a> 
</div></div></div><div class="row">
 <div class="c12">
  <h1 style="font-size: 36px;">在 Ubuntu 16.04 上使用 Python 3 和 psycopg 设置 PostgreSQL</h1>
  <div style="font-size:12px;color:#666;margin:0 0 10px">
     Post updated by <a href="/about-author.html">Matt Makai</a> on 
     December 25, 2017. Originally posted
     on May 18, 2016.
  </div>
 </div>
</div>
<div class="row">
  <div class="c9">
   <p><a href="/postgresql.html">PostgreSQL</a> is a powerful open source 
<a href="/databases.html">relational database</a> frequently used to create, read,
update and delete <a href="/web-frameworks.html">Python web application</a> data.
<a href="http://initd.org/psycopg/">Psycopg2</a> is a PostgreSQL database 
driver that serves as a Python client for access to the PostgreSQL server. 
This post explains how to install PostgreSQL on <a href="/ubuntu.html">Ubuntu 16.04</a> 
and run a few basic SQL queries within a Python program.</p>
<p>We won't cover 
<a href="/object-relational-mappers-orms.html">object-relational mappers (ORMs)</a> 
in this tutorial but these steps can be used as a prerequisite to working 
with an ORM such as SQLAlchemy or Peewee.</p>
<h2>Tools We Need</h2>
<p>Our walkthrough should work with either <a href="/python-2-or-3.html">Python 2 or 3</a> 
although all the steps were tested specifically with Python 3.5. Besides 
the Python interpreter, here are the other components we'll use:</p>
<ul>
<li><a href="http://releases.ubuntu.com/16.04/">Ubuntu 16.04.2</a> (these 
  steps should also work fine with other Ubuntu versions)</li>
<li><a href="https://pip.pypa.io/en/stable/">pip</a> and 
  <a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a> to handle the
  <a href="https://pypi.org/project/psycopg2/2.6.1">psycopg2</a> 
  <a href="/application-dependencies.html">application dependency</a></li>
<li><a href="http://www.postgresql.org/">PostgreSQL</a></li>
</ul>
<p>If you aren't sure how to install pip and virtualenv, review the 
first few steps of the 
<a href="/blog/python-3-bottle-gunicorn-ubuntu-1604-xenial-xerus.html">how to set up Python 3, Bottle and Green Unicorn on Ubuntu 16.04 LTS</a>
guide.</p>
<h2>Install PostgreSQL</h2>
<p>We'll install PostgreSQL via the <code>apt</code> package manager. There are a few
packages we need since we want to both run PostgreSQL and use the psycopg2
driver with our Python programs. PostgreSQL will also be installed as a
system service so we can start, stop and reload its configuration when
necessary with the <code>service</code> command. Open the terminal and run: </p>
<div class="highlight"><pre><span></span>sudo apt-get install postgresql libpq-dev postgresql-client postgresql-client-common
</pre></div>


<p>Enter your <code>sudo</code> password when prompted and enter 'yes' when <code>apt</code> asks
if you want to install the new packages.</p>
<p><img src="/img/160518-postgresql-ubuntu-1604/apt-get-postgresql.png" width="100%" class="technical-diagram img-rounded"></p>
<p>After a few moments <code>apt</code> will finish downloading, installing and 
processing.</p>
<p><img src="/img/160518-postgresql-ubuntu-1604/apt-get-postgresql-done.png" width="100%" class="technical-diagram img-rounded"></p>
<p>We now have PostgreSQL installed and the PostgreSQL service is running
in the background. However, we need to create a user and a database instance
to really start using it. Use the <code>sudo</code> command to switch to the new
"postgres" account.</p>
<div class="highlight"><pre><span></span>sudo -i -u postgres
</pre></div>


<p>Within the "postgres" account, create a user from the command line with the
<code>createuser</code> command. PostgreSQL will prompt you with several questions.
Answer "n" to superuser and "y" to the other questions.</p>
<div class="highlight"><pre><span></span>createuser matt -P --interactive
</pre></div>


<p><img src="/img/160518-postgresql-ubuntu-1604/createuser.png" width="100%" class="technical-diagram img-rounded"></p>
<p>Awesome, now we have a PostgreSQL user that matches our Ubuntu login
account. Exit out of the postgres account by pressing the "Ctrl" key along
with "d" into the shell. We're back in our own user account.</p>
<p>Create a new database we can use for testing. You can name it "testpython"
or whatever you want for your application.</p>
<div class="highlight"><pre><span></span>createdb testpython
</pre></div>


<p>Now we can interact with "testpython" via the PostgreSQL command line tool.</p>
<h2>Interacting with PostgreSQL</h2>
<p>The <code>psql</code> command line client is useful for connecting directly to our
PostgreSQL server without any Python code. Try out <code>psql</code> by using this
command at the prompt: </p>
<div class="highlight"><pre><span></span>psql testpython
</pre></div>


<p>The PostgreSQL client will connect to the localhost server. The client is
now ready for input:</p>
<p><img src="/img/160518-postgresql-ubuntu-1604/postgresql-cli.png" width="100%" class="technical-diagram img-rounded"></p>
<p>Try out PostgreSQL's command prompt a try with commands such as <code>\dt</code> and
<code>\dd</code>. We can also run SQL queries such as "SELECT * from testpython", 
although that won't give us back any data yet because we have not inserted
any into the database. A full list of PostgreSQL commands can be 
found in the
<a href="http://www.postgresql.org/docs/9.6/static/app-psql.html">psql documentation</a>.</p>
<h2>Installing psycopg2</h2>
<p>Now that PostgreSQL is installed and we have a non-superuser account, we
can install the <a href="http://initd.org/psycopg/">psycopg2</a> package. Let's
figure out where our <code>python3</code> executable is located, create a virtualenv
with <code>python3</code>, activate the virtualenv and then install the psycopg2 package
with <code>pip</code>. Find your <code>python3</code> executable using the <code>which</code> command.</p>
<div class="highlight"><pre><span></span>which python3
</pre></div>


<p>We will see output like what is in this screenshot.</p>
<p><img src="/img/160518-postgresql-ubuntu-1604/which-python-3.png" width="100%" class="technical-diagram img-rounded"></p>
<p>Create a new virtualenv in either your home directory or wherever you
store your Python virtualenvs. Specify the full path to your <code>python3</code>
installation. </p>
<div class="highlight"><pre><span></span># specify the system python3 installation
virtualenv --python=/usr/bin/python3 venvs/postgrestest
</pre></div>


<p>Activate the virtualenv.</p>
<div class="highlight"><pre><span></span>source ~/venvs/postgrestest/bin/activate
</pre></div>


<p>Next we can install the psycopg2 Python package from 
<a href="https://pypi.python.org/pypi">PyPI</a> using the <code>pip</code> command.</p>
<div class="highlight"><pre><span></span>pip install psycopg2
</pre></div>


<p><img src="/img/160518-postgresql-ubuntu-1604/pip-install-psycopg2.png" width="100%" class="technical-diagram img-rounded"></p>
<p>Sweet, we've got our PostgreSQL driver installed in our virtualenv! We can 
now test out the installation by writing a few lines of Python code.</p>
<h2>Using PostgreSQL from Python</h2>
<p>Launch the Python REPL with the <code>python</code> or <code>python3</code> command. You can also 
write the following code in a Python file such as "testpostgres.py" then
execute it with <code>python testpostgres.py</code>. Make sure to replace the "user"
and "password" values with your own.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psycopg2</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">connect_str</span> <span class="o">=</span> <span class="s2">&quot;dbname=&#39;testpython&#39; user=&#39;matt&#39; host=&#39;localhost&#39; &quot;</span> <span class="o">+</span> \
                  <span class="s2">&quot;password=&#39;myOwnPassword&#39;&quot;</span>
    <span class="c1"># use our connection values to establish a connection</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">connect_str</span><span class="p">)</span>
    <span class="c1"># create a psycopg2 cursor that can execute queries</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="c1"># create a new table with a single column called &quot;name&quot;</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;CREATE TABLE tutorials (name char(40));&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="c1"># run a SELECT statement - no data in there, but we can try it</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT * from tutorials&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Uh oh, can&#39;t connect. Invalid dbname, user or password?&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>


<p>When we run the above code we won't get anything fancy, just an empty
list printed out. However, in those few lines of code we've ensured our 
connection to our new database works and we can create new tables in it as 
well as query them.</p>
<p><img src="/img/160518-postgresql-ubuntu-1604/output.png" width="100%" class="technical-diagram img-rounded"></p>
<p>That's just enough of a hook to get started writing more complicated SQL 
queries using psycopg2 and PostgreSQL. Make sure to check out the 
<a href="/postgresql.html">PostgreSQL</a>,
<a href="/databases.html">relational databases</a> and 
<a href="/object-relational-mappers-orms.html">object-relational mappers (ORMs)</a>
pages for more tutorials.</p>
<p>Questions? Tweet <a href="https://twitter.com/fullstackpython">@fullstackpython</a>
or post a message on the 
<a href="https://www.facebook.com/fullstackpython">Full Stack Python Facebook page</a>. </p>
<p>See something wrong in this post? Fork 
<a href="https://github.com/mattmakai/fullstackpython.com/blob/master/content/posts/160518-install-postgresql-python-3-ubuntu-1604.markdown">this page's source on GitHub</a>
and submit a pull request.</p>
   <hr>
<div id="mc_embed_signup">
<form action="//mattmakai.us2.list-manage.com/subscribe/post?u=b7e774f0c4f05dcebbfee183d&amp;id=b22335388d" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
 <div id="mc_embed_signup_scroll">
  <h4>Sign up for a monthly email with Full Stack Python tutorials. No spam ever.</h4>
  <div class="row">
   <div class="c9">
    <input type="email" value="" name="EMAIL" class="email form-control" id="mce-EMAIL" placeholder="email address" required>
    <div style="position: absolute; left: -5000px;"><input type="text" name="b_b7e774f0c4f05dcebbfee183d_b22335388d" tabindex="-1" value=""></div>
   </div>
   <div class="c3">
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="btn btn-success" style="font-family: 'Helvetica Neue'; margin-bottom:6px"></div>
   </div>
  </div>
 </div>
</form>
</div>  </div>
  <div class="c3">
<div class="pn">
 <div class="pnh">
  <h3>Learn more</h3>
 </div>
 <img src="/img/160518-postgresql-ubuntu-1604/header.jpg" alt="PostgreSQL 和 Ubuntu logos，版权归各自所有者所有。" width="100%"> 
 <div class="lg">
<a href="/operating-systems.html" class="lgi">Operating Systems</a>
<a href="/ubuntu.html" class="lgi">Ubuntu</a>
<a href="/databases.html" class="lgi">Relational Databases</a>
<a href="/postgresql.html" class="lgi">PostgreSQL</a>  <a href="/table-of-contents.html" class="lgi">...or view all topics.</a>
 </div>
</div><div class="pn">
 <div class="pnh"><h3>Sponsored By</h3></div>
 <div class="pnb">
<a href="https://rollbar.com/"><img src="/img/logos/rbw.jpg" alt="Rollbar logo" width="100%" style="padding:12px 0 18px"></a>
<p class="sps">Fix errors in your Python code before your users see them by <a href="https://rollbar.com/">monitoring with Rollbar</a>.</p> </div>
</div>  </div>
</div>
<hr></div> 
<div style="margin: 0 0 12px;background-color: #22B24C;">
 <div class="cn">
  <p class="banner sns">
   <a href="https://training.talkpython.fm/courses/explore_ansible/introduction-to-ansible-with-python" style="color: #fff">Learn to deploy and configure servers with Ansible in my latest video course</a>!
  </p>
 </div>
</div>
<div class="container">
    <div class="footer pull-right" style="text-align:right; font-size:85%;">
        This site is based on <a href="https://github.com/mattmakai">Matt Makai</a>'s project <a href="https://github.com/mattmakai/fullstackpython.com">Full Stack Python</a>, thanks for his excellent work!
    </div>
</div>
<div class="container">
    <div class="footer pull-right" style="text-align:right; font-size:85%;">
        <p>此网站由 <a href="https://github.com/qiwihui">@qiwihui</a> 维护。
          若发现错误或想贡献，请访问： <a href="https://github.com/qiwihui/fullstackpython.com">Github qiwihui/fullstackpython.com 项目</a>
        </p>
    </div>
</div><script async src="https://www.googletagmanager.com/gtag/js?id=UA-46660488-4"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-46660488-4');</script>
</body>
</html>